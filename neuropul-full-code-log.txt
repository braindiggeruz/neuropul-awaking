// NeuropulAI - Complete Application Code Log
// Generated on: ${new Date().toISOString()}

// ==========================================
// PACKAGE.JSON
// ==========================================

{
  "name": "neuropul-ai",
  "private": true,
  "version": "1.0.1",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "lint": "eslint .",
    "preview": "vite preview",
    "test": "vitest run",
    "test:watch": "vitest",
    "test:coverage": "vitest run --coverage"
  },
  "dependencies": {
    "@supabase/supabase-js": "^2.50.2",
    "framer-motion": "^10.18.0",
    "html2canvas": "^1.4.1",
    "jspdf": "^2.5.2",
    "lucide-react": "^0.344.0",
    "qrcode": "^1.5.4",
    "react": "^18.3.1",
    "react-dom": "^18.3.1",
    "react-router-dom": "^6.22.3"
  },
  "devDependencies": {
    "@eslint/js": "^9.9.1",
    "@testing-library/jest-dom": "^6.4.2",
    "@testing-library/react": "^14.2.1",
    "@testing-library/user-event": "^14.5.2",
    "@types/qrcode": "^1.5.5",
    "@types/react": "^18.3.5",
    "@types/react-dom": "^18.3.0",
    "@vitejs/plugin-react": "^4.3.1",
    "autoprefixer": "^10.4.18",
    "eslint": "^9.9.1",
    "eslint-plugin-react-hooks": "^5.1.0-rc.0",
    "eslint-plugin-react-refresh": "^0.4.11",
    "globals": "^15.9.0",
    "jsdom": "^24.0.0",
    "postcss": "^8.4.35",
    "tailwindcss": "^3.4.1",
    "terser": "^5.28.1",
    "typescript": "^5.5.3",
    "typescript-eslint": "^8.3.0",
    "vite": "^5.4.2",
    "vitest": "^1.3.1"
  }
}

// ==========================================
// INDEX.HTML
// ==========================================

<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
    <title>NeuropulAI - Твой путь к AI-мастерству</title>
    <meta name="description" content="Геймифицированный AI-портал для изучения и использования искусственного интеллекта" />
    <meta name="theme-color" content="#1a1a2e" />
    <meta property="og:title" content="NeuropulAI - Твой путь к AI-мастерству" />
    <meta property="og:description" content="Геймифицированный AI-портал для изучения и использования искусственного интеллекта" />
    <meta property="og:image" content="https://neuropul.ai/og-image.jpg" />
    <meta property="og:url" content="https://neuropul.ai" />
    <meta property="og:type" content="website" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="NeuropulAI - Твой путь к AI-мастерству" />
    <meta name="twitter:description" content="Геймифицированный AI-портал для изучения и использования искусственного интеллекта" />
    <meta name="twitter:image" content="https://neuropul.ai/og-image.jpg" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/manifest.webmanifest" />
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />
    <meta http-equiv="X-Frame-Options" content="DENY" />
    <meta http-equiv="X-XSS-Protection" content="1; mode=block" />
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https://api.dicebear.com https://*.supabase.co https://*.pexels.com https://media.giphy.com; connect-src 'self' https://*.supabase.co https://api.openai.com;" />
    <style>
      @keyframes slide-in-right {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
      
      .animate-slide-in-right {
        animation: slide-in-right 0.3s ease-out;
      }
      
      @keyframes bounce {
        0%, 20%, 53%, 80%, 100% {
          transform: translate3d(0,0,0);
        }
        40%, 43% {
          transform: translate3d(0, -30px, 0);
        }
        70% {
          transform: translate3d(0, -15px, 0);
        }
        90% {
          transform: translate3d(0, -4px, 0);
        }
      }
      
      .animate-bounce {
        animation: bounce 1s ease-in-out infinite;
      }
      
      /* Initial loading animation */
      .initial-loader {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 9999;
      }
      
      .loader-spinner {
        width: 50px;
        height: 50px;
        border: 4px solid rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        border-top: 4px solid #8b5cf6;
        animation: spin 1s linear infinite;
        margin-bottom: 20px;
      }
      
      .loader-text {
        color: #a0a0ff;
        font-family: sans-serif;
      }
      
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;900&display=swap" rel="stylesheet">
  </head>
  <body>
    <!-- Initial loader that shows before React loads -->
    <div id="initial-loader" class="initial-loader">
      <div class="loader-spinner"></div>
      <div class="loader-text">Инициализация NeuropulAI...</div>
    </div>
    
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    <noscript>
      <div style="padding: 2rem; text-align: center; font-family: sans-serif;">
        <h1>JavaScript Required</h1>
        <p>NeuropulAI requires JavaScript to function. Please enable JavaScript in your browser settings and reload the page.</p>
      </div>
    </noscript>
    
    <script>
      // Remove the initial loader once the app has loaded
      window.addEventListener('load', function() {
        const loader = document.getElementById('initial-loader');
        if (loader) {
          loader.style.opacity = '0';
          loader.style.transition = 'opacity 0.5s ease';
          setTimeout(function() {
            loader.style.display = 'none';
          }, 500);
        }
      });
    </script>
  </body>
</html>

// ==========================================
// MAIN.TSX
// ==========================================

import { StrictMode } from 'react';
import { createRoot } from 'react-dom/client';
import App from './App.tsx';
import './index.css';
import './styles/cyberpunk.css';
import { setupGlobalErrorHandling } from './lib/utils/errorLogger';

// Set up global error handling
setupGlobalErrorHandling();

// Create a function to handle errors during rendering
const renderApp = () => {
  try {
    const rootElement = document.getElementById('root');
    if (!rootElement) {
      throw new Error('Root element not found');
    }
    
    const root = createRoot(rootElement);
    
    root.render(
      <StrictMode>
        <App />
      </StrictMode>
    );
  } catch (error) {
    console.error('Error rendering app:', error);
    
    // Display a minimal fallback UI
    const rootElement = document.getElementById('root');
    if (rootElement) {
      rootElement.innerHTML = `
        <div style="min-height: 100vh; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); display: flex; align-items: center; justify-content: center; padding: 20px; color: white; font-family: sans-serif;">
          <div style="background: rgba(0,0,0,0.5); border-radius: 12px; padding: 24px; max-width: 500px; text-align: center;">
            <div style="font-size: 48px; margin-bottom: 16px;">⚠️</div>
            <h2 style="font-size: 24px; margin-bottom: 16px;">Ошибка запуска приложения</h2>
            <p style="margin-bottom: 24px;">Произошла критическая ошибка при запуске NeuropulAI. Пожалуйста, обновите страницу.</p>
            <button onclick="window.location.reload()" style="background: #8b5cf6; border: none; color: white; padding: 12px 24px; border-radius: 8px; cursor: pointer;">
              Обновить страницу
            </button>
          </div>
        </div>
      `;
    }
  }
};

// Call the render function
renderApp();

// ==========================================
// APP.TSX
// ==========================================

import React from 'react';
import { BrowserRouter as Router, Routes, Route, Navigate } from 'react-router-dom';
import Home from './pages/index';
import ErrorBoundary from './components/ErrorBoundary';
import { setupGlobalErrorHandling } from './lib/utils/errorLogger';
import NotFoundPage from './pages/NotFoundPage';
import FocusManager from './components/FocusManager';

// Set up global error handling
setupGlobalErrorHandling();

function App() {
  return (
    <ErrorBoundary>
      <FocusManager>
        <Router>
          <Routes>
            <Route path="/" element={<Home />} />
            <Route path="/index.html" element={<Navigate to="/" replace />} />
            <Route path="*" element={<NotFoundPage onGoHome={() => window.location.href = '/'} />} />
          </Routes>
        </Router>
      </FocusManager>
    </ErrorBoundary>
  );
}

export default App;

// ==========================================
// PAGES/INDEX.TSX
// ==========================================

import React, { useEffect } from 'react';
import TraeAwakensPage from './TraeAwakensPage';
import { setupGlobalErrorHandling } from '../lib/utils/errorLogger';
import { getUserLanguage } from '../lib/utils/i18n';

export default function Home() {
  // Set up global error handling
  useEffect(() => {
    setupGlobalErrorHandling();
    
    // Track page view
    console.log('Page viewed:', window.location.pathname);
    
    // Initialize system
    const isPaid = localStorage.getItem('neuropul_is_paid') === 'true';
    const userPath = localStorage.getItem('neuropul_user_path');
    const userName = localStorage.getItem('neuropul_user_name');
    const xp = parseInt(localStorage.getItem('neuropul_xp') || '0');
    const language = getUserLanguage();
    
    console.log('System initialized:', {
      isPaid,
      userPath,
      userName,
      xp,
      language
    });
    
    // Set default language
    if (!localStorage.getItem('neuropul_language')) {
      // Detect browser language
      const browserLang = navigator.language.startsWith('uz') ? 'uz' : 
                          navigator.language.startsWith('ru') ? 'ru' : 'ru';
      localStorage.setItem('neuropul_language', browserLang);
      console.log('Language set to:', browserLang);
    }
    
    // Set default theme
    if (!localStorage.getItem('neuropul_theme')) {
      localStorage.setItem('neuropul_theme', 'dark');
    }
    
    // Set default sound settings
    if (!localStorage.getItem('neuropul_sound_enabled')) {
      localStorage.setItem('neuropul_sound_enabled', 'true');
    }
    
    // Set default vibration settings
    if (!localStorage.getItem('neuropul_vibration_enabled')) {
      localStorage.setItem('neuropul_vibration_enabled', 'true');
    }
  }, []);
  
  return <TraeAwakensPage />;
}

// ==========================================
// PAGES/TRAEAWAKENSPAGE.TSX
// ==========================================

import React, { useState, useEffect, useRef } from 'react';
import TraeAwakens from '../components/TraeAwakens';
import ResponseLostSoul from '../components/ResponseLostSoul';
import ResponseAwakening from '../components/ResponseAwakening';
import ResponseHackerReady from '../components/ResponseHackerReady';
import { AnimatePresence, motion } from 'framer-motion';
import { saveUserProgress, loadUserProgress, updateUserProgress } from '../utils/progressUtils';

type Screen = 'intro' | 'lost' | 'awakening' | 'ready' | 'portal';

const TraeAwakensPage: React.FC = () => {
  const [currentScreen, setCurrentScreen] = useState<Screen>('intro');
  const [userPath, setUserPath] = useState<string | null>(null);
  const [sessionId, setSessionId] = useState<string>('');
  const [viewCount, setViewCount] = useState(0);
  
  // Refs for cleanup
  const inactivityTimerRef = useRef<NodeJS.Timeout | null>(null);
  const isNavigatingRef = useRef<boolean>(false);

  // Initialize session and tracking
  useEffect(() => {
    // Check if there's a saved path and screen
    const savedPath = localStorage.getItem('neuropul_user_path');
    const savedScreen = localStorage.getItem('neuropul_current_screen');
    
    if (savedPath) {
      setUserPath(savedPath);
      
      // If there's a saved screen that's not 'intro', restore it
      if (savedScreen && savedScreen !== 'intro' && 
          ['lost', 'awakening', 'ready', 'portal'].includes(savedScreen)) {
        console.log(`Restoring saved screen: ${savedScreen}`);
        setCurrentScreen(savedScreen as Screen);
      }
    }
    
    // Generate session ID if not exists
    const existingSessionId = localStorage.getItem('neuropul_session_id');
    if (existingSessionId) {
      setSessionId(existingSessionId);
    } else {
      const newSessionId = `session_${Date.now()}_${Math.random().toString(36).substring(2, 9)}`;
      localStorage.setItem('neuropul_session_id', newSessionId);
      setSessionId(newSessionId);
    }
    
    // Track view count
    const views = parseInt(localStorage.getItem('neuropul_view_count') || '0');
    const newViewCount = views + 1;
    localStorage.setItem('neuropul_view_count', newViewCount.toString());
    setViewCount(newViewCount);
    
    // Track first visit date if not set
    if (!localStorage.getItem('neuropul_first_visit')) {
      localStorage.setItem('neuropul_first_visit', new Date().toISOString());
    }
    
    // Track last visit date
    localStorage.setItem('neuropul_last_visit', new Date().toISOString());
    
    // Log user agent for analytics
    const userAgent = navigator.userAgent;
    localStorage.setItem('neuropul_user_agent', userAgent);
    
    // Initialize XP if not exists
    if (!localStorage.getItem('neuropul_xp')) {
      localStorage.setItem('neuropul_xp', '0');
    }
    
    // Initialize isPaid flag if not exists
    if (!localStorage.getItem('neuropul_is_paid')) {
      localStorage.setItem('neuropul_is_paid', 'false');
    }
    
    // Load or initialize user progress
    const existingProgress = loadUserProgress();
    if (!existingProgress) {
      saveUserProgress({
        name: '',
        archetype: null,
        avatarUrl: '',
        xp: 0,
        level: 1,
        prophecy: '',
        awakened: false,
        createdAt: new Date().toISOString(),
        lastActive: new Date().toISOString(),
        questStep: 0
      });
    }
    
    // Cleanup function
    return () => {
      if (inactivityTimerRef.current) {
        clearTimeout(inactivityTimerRef.current);
      }
    };
  }, []);

  const handlePathSelect = (path: 'lost' | 'awakening' | 'ready') => {
    if (isNavigatingRef.current) return;
    isNavigatingRef.current = true;
    
    setCurrentScreen(path);
    setUserPath(path);
    
    // Save current screen and path to localStorage
    localStorage.setItem('neuropul_current_screen', path);
    localStorage.setItem('neuropul_user_path', path);
    
    // Log user selection
    console.log(`User selected path: ${path}`);
    console.log(`Session ID: ${sessionId}`);
    console.log(`View count: ${viewCount}`);
    
    // Track path selection
    localStorage.setItem('neuropul_path_selected_at', new Date().toISOString());
    
    // Set level_selected flag
    localStorage.setItem('neuropul_level_selected', 'true');
    
    // Update user progress
    updateUserProgress({
      userPath: path,
      questStep: 1,
      lastActive: new Date().toISOString()
    });
    
    // Reset navigation lock after a short delay
    setTimeout(() => {
      isNavigatingRef.current = false;
    }, 300);
  };

  const handleBack = () => {
    if (isNavigatingRef.current) return;
    isNavigatingRef.current = true;
    
    setCurrentScreen('intro');
    
    // Update localStorage
    localStorage.setItem('neuropul_current_screen', 'intro');
    
    // Log navigation
    console.log('User navigated back to intro');
    
    // Update user progress
    updateUserProgress({
      questStep: 0,
      lastActive: new Date().toISOString()
    });
    
    // Reset navigation lock after a short delay
    setTimeout(() => {
      isNavigatingRef.current = false;
    }, 300);
  };

  const handleContinueToPortal = () => {
    if (isNavigatingRef.current) return;
    isNavigatingRef.current = true;
    
    setCurrentScreen('portal');
    
    // Update localStorage
    localStorage.setItem('neuropul_current_screen', 'portal');
    
    // Log completion
    console.log('User completed introduction');
    console.log(`Final path: ${userPath}`);
    
    // Set completion flag
    localStorage.setItem('neuropul_intro_completed', 'true');
    localStorage.setItem('neuropul_intro_completed_at', new Date().toISOString());
    
    // Update user progress
    updateUserProgress({
      questStep: 2,
      lastActive: new Date().toISOString()
    });
    
    // Check if this is the third message viewed (for CTA trigger)
    const messagesViewed = parseInt(localStorage.getItem('neuropul_viewed_messages') || '0');
    if (messagesViewed >= 3) {
      // Set flag for CTA
      localStorage.setItem('neuropul_show_cta', 'true');
    }
    
    // In a real implementation, you would navigate to the awakening portal or dashboard
    // For now, we'll just redirect to the home page after a delay
    const redirectTimeout = setTimeout(() => {
      // Check if we should show CTA
      if (localStorage.getItem('neuropul_show_cta') === 'true' && localStorage.getItem('neuropul_is_paid') !== 'true') {
        // Redirect to CTA page
        window.location.href = '/premium';
      } else {
        // Redirect to main app
        window.location.href = '/';
      }
      
      // Reset navigation lock
      isNavigatingRef.current = false;
    }, 500);
    
    // Cleanup function for the timeout
    return () => clearTimeout(redirectTimeout);
  };

  // Auto-reset session after inactivity
  useEffect(() => {
    // Clear previous timer if it exists
    if (inactivityTimerRef.current) {
      clearTimeout(inactivityTimerRef.current);
    }
    
    // Set new timer
    inactivityTimerRef.current = setTimeout(() => {
      // If user has been inactive for 30 minutes, reset session
      const lastActivity = localStorage.getItem('neuropul_last_activity');
      if (lastActivity) {
        const lastActivityTime = new Date(lastActivity).getTime();
        const currentTime = new Date().getTime();
        const inactiveTime = currentTime - lastActivityTime;
        
        // 30 minutes in milliseconds
        if (inactiveTime > 30 * 60 * 1000) {
          console.log('Session reset due to inactivity');
          // Don't clear everything, just reset the current session
          localStorage.removeItem('neuropul_session_id');
          // Generate new session
          const newSessionId = `session_${Date.now()}_${Math.random().toString(36).substring(2, 9)}`;
          localStorage.setItem('neuropul_session_id', newSessionId);
          setSessionId(newSessionId);
        }
      }
    }, 60000); // Check every minute
    
    // Update last activity timestamp
    localStorage.setItem('neuropul_last_activity', new Date().toISOString());
    
    // Cleanup function
    return () => {
      if (inactivityTimerRef.current) {
        clearTimeout(inactivityTimerRef.current);
      }
    };
  }, [currentScreen]);

  return (
    <div className="relative min-h-screen overflow-hidden">
      <AnimatePresence mode="wait">
        {currentScreen === 'intro' && (
          <motion.div
            key="intro"
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            transition={{ duration: 0.5 }}
          >
            <TraeAwakens onPathSelect={handlePathSelect} />
          </motion.div>
        )}
        
        {currentScreen === 'lost' && (
          <motion.div
            key="lost"
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            transition={{ duration: 0.5 }}
          >
            <ResponseLostSoul onContinue={handleContinueToPortal} onBack={handleBack} />
          </motion.div>
        )}
        
        {currentScreen === 'awakening' && (
          <motion.div
            key="awakening"
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            transition={{ duration: 0.5 }}
          >
            <ResponseAwakening onContinue={handleContinueToPortal} onBack={handleBack} />
          </motion.div>
        )}
        
        {currentScreen === 'ready' && (
          <motion.div
            key="ready"
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            transition={{ duration: 0.5 }}
          >
            <ResponseHackerReady onContinue={handleContinueToPortal} onBack={handleBack} />
          </motion.div>
        )}
        
        {currentScreen === 'portal' && (
          <motion.div
            key="portal"
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            transition={{ duration: 0.5 }}
            className="min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-blue-900 flex items-center justify-center"
          >
            <div className="text-center">
              <div className="w-16 h-16 border-4 border-cyan-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
              <p className="text-white text-lg">Переход к порталу пробуждения...</p>
            </div>
          </motion.div>
        )}
      </AnimatePresence>
      
      {/* Global CSS for cyberpunk effects */}
      <style jsx global>{`
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;900&display=swap');
        
        @keyframes digitalRain {
          0% { transform: translateY(-100px); }
          100% { transform: translateY(100vh); }
        }
        
        .bg-scanline {
          background: linear-gradient(
            to bottom,
            transparent 50%,
            rgba(0, 0, 0, 0.5) 50%
          );
          background-size: 100% 4px;
        }
        
        .glitch-text {
          position: relative;
          animation: glitch 3s infinite;
          color: rgba(139, 92, 246, 0.5);
        }
        
        @keyframes glitch {
          0% { transform: translate(0); }
          20% { transform: translate(-2px, 2px); }
          40% { transform: translate(-2px, -2px); }
          60% { transform: translate(2px, 2px); }
          80% { transform: translate(2px, -2px); }
          100% { transform: translate(0); }
        }
        
        .glitch-corner {
          background: linear-gradient(45deg, transparent 48%, #00ffff 49%, transparent 51%);
          animation: cornerGlitch 2s infinite;
        }
        
        @keyframes cornerGlitch {
          0% { transform: scale(1); opacity: 0.3; }
          50% { transform: scale(1.2); opacity: 0.6; }
          51% { transform: scale(0.8); opacity: 0.3; }
          100% { transform: scale(1); opacity: 0.3; }
        }
      `}</style>
    </div>
  );
};

export default TraeAwakensPage;

// ==========================================
// COMPONENTS/TRAEAWAKENS.TSX
// ==========================================

import React, { useState, useEffect, useRef } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Brain, ArrowRight, Zap, Skull, Rocket, PenIcon as AlienIcon } from 'lucide-react';
import { logError } from '../lib/utils/errorLogger';
import { getUserLanguage, setUserLanguage, translate } from '../lib/utils/i18n';
import LanguageSwitcher from './LanguageSwitcher';
import { playSound, vibrate, cleanupAudio } from '../utils/audioUtils';
import { saveUserProgress, loadUserProgress, updateUserProgress } from '../utils/progressUtils';

interface TraeAwakensProps {
  onPathSelect: (path: 'lost' | 'awakening' | 'ready') => void;
}

const TraeAwakens: React.FC<TraeAwakensProps> = ({ onPathSelect }) => {
  const [isVisible, setIsVisible] = useState(false);
  const [message, setMessage] = useState('');
  const [isTyping, setIsTyping] = useState(true);
  const [showOptions, setShowOptions] = useState(false);
  const [userPath, setUserPath] = useState<string | null>(null);
  const [language, setLanguage] = useState<'ru' | 'uz'>(getUserLanguage());
  const [isNavigating, setIsNavigating] = useState(false);
  
  // Refs to prevent stale closures in event handlers
  const isNavigatingRef = useRef(false);
  const languageRef = useRef(language);
  const timeoutRefs = useRef<NodeJS.Timeout[]>([]);
  const inactivityTimerRef = useRef<NodeJS.Timeout | null>(null);

  // Update refs when state changes
  useEffect(() => {
    isNavigatingRef.current = isNavigating;
    languageRef.current = language;
  }, [isNavigating, language]);

  // Check for existing path in localStorage
  useEffect(() => {
    const savedPath = localStorage.getItem('neuropul_user_path');
    if (savedPath && (savedPath === 'lost' || savedPath === 'awakening' || savedPath === 'ready')) {
      // If user already selected a path, continue from there
      console.log('Found saved path:', savedPath);
      setUserPath(savedPath);
      
      // Small delay to ensure component is fully mounted
      const timer = setTimeout(() => {
        if (!isNavigatingRef.current) {
          onPathSelect(savedPath as 'lost' | 'awakening' | 'ready');
        }
      }, 100);
      
      timeoutRefs.current.push(timer);
    }
  }, [onPathSelect]);

  // Determine language from URL or localStorage
  useEffect(() => {
    try {
      const detectedLanguage = getUserLanguage();
      console.log('Initial language detection:', detectedLanguage);
      setLanguage(detectedLanguage);
    } catch (error) {
      console.error('Error in language detection:', error);
      logError(error, {
        component: 'TraeAwakens',
        action: 'languageDetection'
      });
    }
  }, []);

  // Trae's initial message based on language
  const getTraeMessage = () => {
    return language === 'ru' 
      ? "Ты здесь. Наконец-то. Я Trae — твой проводник в мире AI. Не буду тратить время на формальности. Мне нужно знать только одно..."
      : "Sen bu yerdasаn. Nihoyat. Men Trae — AI dunyosidagi yo'lboshchingman. Rasmiyatchilikka vaqt sarflamayman. Menga faqat bitta narsa bilish kerak...";
  };

  const getTraeQuestion = () => {
    return language === 'ru' ? "Кто ты?" : "Sen kimsan?";
  };

  // Simulate typing effect
  useEffect(() => {
    let typingInterval: NodeJS.Timeout;
    let questionTimeout: NodeJS.Timeout;
    let optionsTimeout: NodeJS.Timeout;
    
    try {
      setIsVisible(true);
      
      // Try to get user name from localStorage
      const savedName = localStorage.getItem('neuropul_user_name');
      if (savedName) {
        console.log(`User name loaded: ${savedName}`);
      }
      
      // Load user progress
      const userProgress = loadUserProgress();
      if (userProgress) {
        console.log('User progress loaded:', userProgress);
      }
      
      const traeMessage = getTraeMessage();
      let currentText = '';
      let currentIndex = 0;
      
      typingInterval = setInterval(() => {
        if (currentIndex < traeMessage.length) {
          currentText += traeMessage[currentIndex];
          setMessage(currentText);
          currentIndex++;
        } else {
          clearInterval(typingInterval);
          setIsTyping(false);
          
          // Show the question after a short delay
          questionTimeout = setTimeout(() => {
            setMessage(prev => `${prev}\n\n${getTraeQuestion()}`);
            
            // Show options after another delay
            optionsTimeout = setTimeout(() => {
              setShowOptions(true);
              
              // Set inactivity timer
              if (inactivityTimerRef.current) {
                clearTimeout(inactivityTimerRef.current);
              }
              
              const timer = setTimeout(() => {
                if (!userPath) {
                  setMessage(prev => `${prev}\n\n${language === 'ru' ? 'Эй, ты ещё здесь? Выбери свой путь, чтобы мы могли начать.' : 'Hey, hali ham shu yerdamisan? Boshlashimiz uchun yo\'lingni tanla.'}`);
                  playSound('hover', true);
                  vibrate([100, 50, 100], true);
                }
              }, 15000); // 15 seconds
              
              inactivityTimerRef.current = timer;
              timeoutRefs.current.push(timer);
            }, 1000);
            
            timeoutRefs.current.push(optionsTimeout);
          }, 500);
          
          timeoutRefs.current.push(questionTimeout);
        }
      }, 30); // Typing speed
      
      timeoutRefs.current.push(typingInterval);
      
      return () => {
        // Clean up all timeouts
        clearInterval(typingInterval);
        clearTimeout(questionTimeout);
        clearTimeout(optionsTimeout);
        
        if (inactivityTimerRef.current) {
          clearTimeout(inactivityTimerRef.current);
          inactivityTimerRef.current = null;
        }
        
        // Clean up audio resources
        cleanupAudio();
      };
    } catch (error) {
      console.error('Error in typing effect:', error);
      logError(error, {
        component: 'TraeAwakens',
        action: 'typingEffect'
      });
      
      // Cleanup on error
      clearInterval(typingInterval);
      clearTimeout(questionTimeout);
      clearTimeout(optionsTimeout);
      
      // Fallback to show options immediately
      setIsTyping(false);
      setMessage(`${getTraeMessage()}\n\n${getTraeQuestion()}`);
      setShowOptions(true);
    }
  }, [language]);

  // Clean up all timeouts when component unmounts
  useEffect(() => {
    return () => {
      // Clear all timeouts
      timeoutRefs.current.forEach(timeout => clearTimeout(timeout));
      
      if (inactivityTimerRef.current) {
        clearTimeout(inactivityTimerRef.current);
      }
      
      // Clean up audio resources
      cleanupAudio();
    };
  }, []);

  const handleOptionClick = (path: 'lost' | 'awakening' | 'ready') => {
    // Prevent multiple clicks
    if (isNavigatingRef.current) {
      console.log('Navigation already in progress, ignoring click');
      return;
    }
    
    console.log(`Clicked option: ${path}`);
    setIsNavigating(true);
    isNavigatingRef.current = true;
    
    try {
      // Clear inactivity timer
      if (inactivityTimerRef.current) {
        clearTimeout(inactivityTimerRef.current);
        inactivityTimerRef.current = null;
      }
      
      // Save user path to localStorage for future reference
      localStorage.setItem('neuropul_user_path', path);
      localStorage.setItem('neuropul_first_visit_date', new Date().toISOString());
      localStorage.setItem('neuropul_current_screen', path);
      
      // Set user path in state
      setUserPath(path);
      
      // Initialize or update user progress
      const existingProgress = loadUserProgress();
      if (existingProgress) {
        updateUserProgress({
          questStep: 1,
          lastActive: new Date().toISOString(),
          userPath: path
        });
      } else {
        // Create initial progress
        saveUserProgress({
          name: '',
          archetype: null,
          avatarUrl: '',
          xp: 0,
          level: 1,
          prophecy: '',
          awakened: false,
          createdAt: new Date().toISOString(),
          lastActive: new Date().toISOString(),
          userPath: path,
          questStep: 1
        });
      }
      
      // Play sound and vibrate
      playSound('click', true);
      vibrate([50, 30, 50], true);
      
      // Call the onPathSelect callback with a small delay
      const navigationTimeout = setTimeout(() => {
        console.log(`Navigating to path: ${path}`);
        onPathSelect(path);
        
        // Reset navigation state after a delay in case the navigation fails
        const resetTimeout = setTimeout(() => {
          setIsNavigating(false);
          isNavigatingRef.current = false;
        }, 1000);
        
        timeoutRefs.current.push(resetTimeout);
      }, 100);
      
      timeoutRefs.current.push(navigationTimeout);
    } catch (error) {
      console.error('Error in handleOptionClick:', error);
      logError(error, {
        component: 'TraeAwakens',
        action: 'handleOptionClick',
        additionalData: { path }
      });
      
      // Reset navigation state
      setIsNavigating(false);
      isNavigatingRef.current = false;
    }
  };

  // Handle custom user input
  const [userInput, setUserInput] = useState('');
  const [showInput, setShowInput] = useState(false);

  const handleCustomInput = () => {
    if (userInput.trim() && !isNavigatingRef.current) {
      setIsNavigating(true);
      isNavigatingRef.current = true;
      
      try {
        // Process user input to determine path
        const input = userInput.toLowerCase();
        let detectedPath: 'lost' | 'awakening' | 'ready' = 'awakening'; // Default
        
        if (input.includes('не знаю') || input.includes('потерян') || input.includes('новичок') || 
            input.includes('bilmayman') || input.includes('yo\'qolgan') || input.includes('yangi')) {
          detectedPath = 'lost';
        } else if (input.includes('опыт') || input.includes('знаю') || input.includes('эксперт') ||
                  input.includes('tajriba') || input.includes('bilaman') || input.includes('ekspert')) {
          detectedPath = 'ready';
        }
        
        // Save user input for context
        localStorage.setItem('neuropul_user_input', userInput);
        localStorage.setItem('neuropul_user_path', detectedPath);
        localStorage.setItem('neuropul_current_screen', detectedPath);
        
        // Initialize or update user progress
        const existingProgress = loadUserProgress();
        if (existingProgress) {
          updateUserProgress({
            questStep: 1,
            lastActive: new Date().toISOString(),
            userPath: detectedPath
          });
        } else {
          // Create initial progress
          saveUserProgress({
            name: '',
            archetype: null,
            avatarUrl: '',
            xp: 0,
            level: 1,
            prophecy: '',
            awakened: false,
            createdAt: new Date().toISOString(),
            lastActive: new Date().toISOString(),
            userPath: detectedPath,
            questStep: 1
          });
        }
        
        // Play sound and vibrate
        playSound('click', true);
        vibrate([50, 30, 50], true);
        
        // Call the onPathSelect callback with a small delay
        const navigationTimeout = setTimeout(() => {
          onPathSelect(detectedPath);
          
          // Reset navigation state after a delay in case the navigation fails
          const resetTimeout = setTimeout(() => {
            setIsNavigating(false);
            isNavigatingRef.current = false;
          }, 1000);
          
          timeoutRefs.current.push(resetTimeout);
        }, 100);
        
        timeoutRefs.current.push(navigationTimeout);
      } catch (error) {
        console.error('Error in handleCustomInput:', error);
        logError(error, {
          component: 'TraeAwakens',
          action: 'handleCustomInput',
          additionalData: { userInput }
        });
        
        // Reset navigation state
        setIsNavigating(false);
        isNavigatingRef.current = false;
      }
    }
  };

  // Language switcher
  const handleLanguageChange = (newLang: 'ru' | 'uz') => {
    try {
      console.log(`Language changed from ${language} to ${newLang}`);
      setLanguage(newLang);
      
      // Reset message and typing state to show message in new language
      setIsTyping(true);
      setMessage('');
      setShowOptions(false);
      
      // Restart typing effect with new language
      const traeMessage = getTraeMessage();
      let currentText = '';
      let currentIndex = 0;
      
      const typingInterval = setInterval(() => {
        if (currentIndex < traeMessage.length) {
          currentText += traeMessage[currentIndex];
          setMessage(currentText);
          currentIndex++;
        } else {
          clearInterval(typingInterval);
          setIsTyping(false);
          
          // Show continue button after message is fully typed
          setTimeout(() => {
            setShowOptions(true);
          }, 500);
        }
      }, 20);
    } catch (error) {
      console.error('Error changing language:', error);
      logError(error, {
        component: 'TraeAwakens',
        action: 'handleLanguageChange'
      });
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-blue-900 flex items-center justify-center p-4 overflow-hidden">
      {/* Background cyberpunk elements with enhanced effects */}
      <div className="absolute inset-0 overflow-hidden">
        {/* Cyberpunk grid */}
        <div className="absolute top-0 left-0 w-full h-full bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxkZWZzPjxwYXR0ZXJuIGlkPSJncmlkIiB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHBhdHRlcm5Vbml0cz0idXNlclNwYWNlT25Vc2UiPjxwYXRoIGQ9Ik0gNDAgMCBMIDAgMCAwIDQwIiBmaWxsPSJub25lIiBzdHJva2U9IiM4YjVjZjYiIHN0cm9rZS13aWR0aD0iMC41Ii8+PC9wYXR0ZXJuPjwvZGVmcz48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ1cmwoI2dyaWQpIiBvcGFjaXR5PSIwLjA1Ii8+PC9zdmc+')]"></div>
        
        {/* Animated glowing orbs */}
        <div className="absolute top-1/4 left-1/4 w-96 h-96 bg-purple-500 rounded-full filter blur-[100px] opacity-20 animate-pulse"></div>
        <div className="absolute bottom-1/4 right-1/4 w-96 h-96 bg-blue-500 rounded-full filter blur-[100px] opacity-20 animate-pulse" style={{ animationDelay: '1s' }}></div>
        
        {/* Digital rain effect (matrix-like) */}
        <div className="absolute inset-0 opacity-10 pointer-events-none overflow-hidden">
          <div className="absolute top-0 left-0 w-full h-full">
            {Array.from({ length: 10 }).map((_, i) => (
              <div 
                key={i}
                className="absolute text-cyan-500 text-xs font-mono"
                style={{
                  left: `${Math.random() * 100}%`,
                  top: 0,
                  opacity: 0.5 + Math.random() * 0.5,
                  animation: `digitalRain ${5 + Math.random() * 10}s linear infinite`,
                  animationDelay: `${Math.random() * 5}s`
                }}
              >
                {Array.from({ length: 20 }).map((_, j) => (
                  <div key={j} className="my-1">
                    {Math.random() > 0.5 ? '1' : '0'}
                  </div>
                ))}
              </div>
            ))}
          </div>
        </div>
        
        {/* Scanlines effect */}
        <div className="absolute inset-0 bg-scanline opacity-5 pointer-events-none"></div>
      </div>
      
      {/* Language switcher */}
      <div className="absolute top-4 right-4 z-20">
        <LanguageSwitcher onLanguageChange={handleLanguageChange} />
      </div>
      
      <div className="relative z-10 max-w-3xl w-full">
        <AnimatePresence>
          {isVisible && (
            <motion.div
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              exit={{ opacity: 0, y: -20 }}
              transition={{ duration: 0.5 }}
              className="bg-black bg-opacity-40 backdrop-blur-md rounded-2xl p-8 border border-purple-500 border-opacity-30 shadow-2xl"
            >
              {/* Trae Header with enhanced cyberpunk style */}
              <div className="flex items-center mb-6">
                <div className="w-14 h-14 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full flex items-center justify-center mr-4 shadow-[0_0_15px_rgba(139,92,246,0.5)] relative">
                  {/* Pulsing ring effect */}
                  <div className="absolute inset-0 rounded-full border border-purple-500 animate-ping opacity-30"></div>
                  <Brain className="w-8 h-8 text-white" />
                </div>
                <div>
                  <h2 className="text-2xl font-bold text-white font-['Orbitron',sans-serif]">Trae</h2>
                  <p className="text-purple-300 text-sm">
                    {language === 'ru' ? 'AI-Наставник' : 'AI-Murabbiy'}
                  </p>
                </div>
                
                {/* Connection status indicator */}
                <div className="ml-auto flex items-center">
                  <div className="w-2 h-2 rounded-full bg-green-500 mr-2 animate-pulse"></div>
                  <span className="text-green-400 text-xs">ONLINE</span>
                </div>
              </div>
              
              {/* Message with glitch effect */}
              <div className="mb-8 relative">
                <p className="text-white text-lg leading-relaxed whitespace-pre-line font-['Courier_New',monospace] relative">
                  {message}
                  {isTyping && (
                    <span className="inline-block ml-1 animate-pulse">|</span>
                  )}
                </p>
                
                {/* Glitch effect overlay */}
                <div className="absolute inset-0 pointer-events-none overflow-hidden opacity-10">
                  <div className="glitch-text">{message}</div>
                </div>
              </div>
              
              {/* Options */}
              <AnimatePresence>
                {showOptions && (
                  <motion.div
                    initial={{ opacity: 0, y: 20 }}
                    animate={{ opacity: 1, y: 0 }}
                    transition={{ duration: 0.5, delay: 0.2 }}
                    className="space-y-4"
                  >
                    <motion.button
                      initial={{ opacity: 0, x: -20 }}
                      animate={{ opacity: 1, x: 0 }}
                      transition={{ duration: 0.3, delay: 0.3 }}
                      onClick={() => handleOptionClick('lost')}
                      onMouseEnter={() => playSound('hover', true)}
                      className="w-full p-4 bg-gray-800 hover:bg-gray-700 border border-gray-700 hover:border-purple-500 rounded-xl transition-all duration-300 flex items-center space-x-3 group relative overflow-hidden"
                      aria-label={language === 'ru' ? 'Я потерян' : 'Men yo\'qolganman'}
                      disabled={isNavigating}
                      id="lost-soul-button"
                      data-testid="lost-soul-button"
                    >
                      {/* Hover effect */}
                      <div className="absolute inset-0 bg-gradient-to-r from-purple-600 to-blue-600 opacity-0 group-hover:opacity-10 transition-opacity"></div>
                      
                      <div className="w-10 h-10 bg-gray-700 group-hover:bg-gray-600 rounded-full flex items-center justify-center relative z-10">
                        <Skull className="w-5 h-5 text-gray-400 group-hover:text-purple-400" />
                      </div>
                      <div className="text-left relative z-10">
                        <p className="text-white font-semibold">
                          {language === 'ru' ? '💀 Я потерян' : '💀 Men yo\'qolganman'}
                        </p>
                        <p className="text-gray-400 text-sm">
                          {language === 'ru' 
                            ? 'Не знаю, что такое AI и зачем он мне' 
                            : 'AI nima ekanligini va nima uchun kerakligini bilmayman'}
                        </p>
                      </div>
                    </motion.button>
                    
                    <motion.button
                      initial={{ opacity: 0, x: -20 }}
                      animate={{ opacity: 1, x: 0 }}
                      transition={{ duration: 0.3, delay: 0.4 }}
                      onClick={() => handleOptionClick('awakening')}
                      onMouseEnter={() => playSound('hover', true)}
                      className="w-full p-4 bg-gradient-to-r from-purple-900 to-blue-900 hover:from-purple-800 hover:to-blue-800 border border-purple-700 hover:border-purple-500 rounded-xl transition-all duration-300 flex items-center space-x-3 group relative overflow-hidden"
                      aria-label={language === 'ru' ? 'Хочу пробудиться' : 'Uyg\'onishni xohlayman'}
                      disabled={isNavigating}
                      id="awakening-button"
                      data-testid="awakening-button"
                    >
                      {/* Animated highlight effect */}
                      <div className="absolute inset-0 bg-gradient-to-r from-purple-500 to-blue-500 opacity-0 group-hover:opacity-20 transition-opacity"></div>
                      <div className="absolute -inset-1 bg-gradient-to-r from-purple-600 to-blue-600 rounded-xl blur opacity-20 group-hover:opacity-30 transition-opacity"></div>
                      
                      <div className="w-10 h-10 bg-purple-800 group-hover:bg-purple-700 rounded-full flex items-center justify-center relative z-10">
                        <Rocket className="w-5 h-5 text-purple-300 group-hover:text-purple-200" />
                      </div>
                      <div className="text-left relative z-10">
                        <p className="text-white font-semibold">
                          {language === 'ru' ? '🚀 Хочу пробудиться' : '🚀 Uyg\'onishni xohlayman'}
                        </p>
                        <p className="text-purple-300 text-sm">
                          {language === 'ru' 
                            ? 'Готов начать путь AI-мастерства' 
                            : 'AI-mahorat yo\'lini boshlashga tayyorman'}
                        </p>
                      </div>
                    </motion.button>
                    
                    <motion.button
                      initial={{ opacity: 0, x: -20 }}
                      animate={{ opacity: 1, x: 0 }}
                      transition={{ duration: 0.3, delay: 0.5 }}
                      onClick={() => handleOptionClick('ready')}
                      onMouseEnter={() => playSound('hover', true)}
                      className="w-full p-4 bg-gray-800 hover:bg-gray-700 border border-gray-700 hover:border-purple-500 rounded-xl transition-all duration-300 flex items-center space-x-3 group relative overflow-hidden"
                      aria-label={language === 'ru' ? 'Я уже в теме' : 'Men allaqachon bilaman'}
                      disabled={isNavigating}
                      id="ready-button"
                      data-testid="ready-button"
                    >
                      {/* Hover effect */}
                      <div className="absolute inset-0 bg-gradient-to-r from-purple-600 to-blue-600 opacity-0 group-hover:opacity-10 transition-opacity"></div>
                      
                      <div className="w-10 h-10 bg-gray-700 group-hover:bg-gray-600 rounded-full flex items-center justify-center relative z-10">
                        <AlienIcon className="w-5 h-5 text-gray-400 group-hover:text-purple-400" />
                      </div>
                      <div className="text-left relative z-10">
                        <p className="text-white font-semibold">
                          {language === 'ru' ? '👽 Я уже в теме' : '👽 Men allaqachon bilaman'}
                        </p>
                        <p className="text-gray-400 text-sm">
                          {language === 'ru' 
                            ? 'Знаю, что такое AI и как его использовать' 
                            : 'AI nima ekanligini va undan qanday foydalanishni bilaman'}
                        </p>
                      </div>
                    </motion.button>
                    
                    {/* Custom input option */}
                    <motion.div
                      initial={{ opacity: 0, y: 20 }}
                      animate={{ opacity: 1, y: 0 }}
                      transition={{ duration: 0.3, delay: 0.6 }}
                      className="mt-4"
                    >
                      {!showInput ? (
                        <button
                          onClick={() => setShowInput(true)}
                          onMouseEnter={() => playSound('hover', true)}
                          className="text-purple-400 hover:text-purple-300 text-sm transition-colors flex items-center mx-auto"
                          aria-label={language === 'ru' ? 'Описать свой опыт своими словами' : 'Tajribangizni o\'z so\'zlaringiz bilan tasvirlang'}
                          disabled={isNavigating}
                        >
                          <span>
                            {language === 'ru' 
                              ? 'Или опиши свой опыт своими словами...' 
                              : 'Yoki tajribangizni o\'z so\'zlaringiz bilan tasvirlang...'}
                          </span>
                        </button>
                      ) : (
                        <div className="flex space-x-2">
                          <input
                            type="text"
                            value={userInput}
                            onChange={(e) => setUserInput(e.target.value)}
                            placeholder={language === 'ru' 
                              ? 'Расскажи о своём опыте с AI...' 
                              : 'AI bilan tajribangiz haqida gapiring...'}
                            className="flex-1 bg-gray-800 border border-gray-700 focus:border-purple-500 rounded-lg px-4 py-2 text-white placeholder-gray-500 focus:outline-none"
                            onKeyPress={(e) => e.key === 'Enter' && handleCustomInput()}
                            aria-label={language === 'ru' ? 'Ваш опыт с AI' : 'AI bilan tajribangiz'}
                            disabled={isNavigating}
                          />
                          <button
                            onClick={handleCustomInput}
                            onMouseEnter={() => playSound('hover', true)}
                            className="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors"
                            aria-label={language === 'ru' ? 'Отправить' : 'Yuborish'}
                            disabled={isNavigating}
                          >
                            {language === 'ru' ? 'Отправить' : 'Yuborish'}
                          </button>
                        </div>
                      )}
                    </motion.div>
                  </motion.div>
                )}
              </AnimatePresence>
              
              {/* Loading indicator */}
              {isNavigating && (
                <motion.div
                  initial={{ opacity: 0 }}
                  animate={{ opacity: 1 }}
                  className="mt-6 flex justify-center"
                >
                  <div className="flex items-center space-x-3">
                    <div className="w-4 h-4 bg-purple-600 rounded-full animate-pulse"></div>
                    <div className="w-4 h-4 bg-blue-600 rounded-full animate-pulse" style={{ animationDelay: '0.3s' }}></div>
                    <div className="w-4 h-4 bg-cyan-600 rounded-full animate-pulse" style={{ animationDelay: '0.6s' }}></div>
                  </div>
                </motion.div>
              )}
              
              {/* Cyberpunk decorative elements with enhanced effects */}
              <div className="absolute -bottom-3 -right-3 w-24 h-24 border-r-2 border-b-2 border-cyan-500 opacity-50 animate-pulse"></div>
              <div className="absolute -top-3 -left-3 w-24 h-24 border-l-2 border-t-2 border-purple-500 opacity-50 animate-pulse" style={{ animationDelay: '1.5s' }}></div>
              
              {/* Glitch corner effect */}
              <div className="absolute bottom-0 right-0 w-20 h-20 overflow-hidden opacity-30 pointer-events-none">
                <div className="absolute inset-0 glitch-corner"></div>
              </div>
              
              {/* Neuropul logo/branding */}
              <div className="absolute bottom-4 left-4 text-xs text-purple-500 opacity-50 font-['Orbitron',sans-serif]">
                NEUROPUL.AI
              </div>
            </motion.div>
          )}
        </AnimatePresence>
      </div>
      
      {/* Global CSS for cyberpunk effects */}
      <style jsx global>{`
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;900&display=swap');
        
        @keyframes digitalRain {
          0% { transform: translateY(-100px); }
          100% { transform: translateY(100vh); }
        }
        
        .bg-scanline {
          background: linear-gradient(
            to bottom,
            transparent 50%,
            rgba(0, 0, 0, 0.5) 50%
          );
          background-size: 100% 4px;
        }
        
        .glitch-text {
          position: relative;
          animation: glitch 3s infinite;
          color: rgba(139, 92, 246, 0.5);
        }
        
        @keyframes glitch {
          0% { transform: translate(0); }
          20% { transform: translate(-2px, 2px); }
          40% { transform: translate(-2px, -2px); }
          60% { transform: translate(2px, 2px); }
          80% { transform: translate(2px, -2px); }
          100% { transform: translate(0); }
        }
        
        .glitch-corner {
          background: linear-gradient(45deg, transparent 48%, #00ffff 49%, transparent 51%);
          animation: cornerGlitch 2s infinite;
        }
        
        @keyframes cornerGlitch {
          0% { transform: scale(1); opacity: 0.3; }
          50% { transform: scale(1.2); opacity: 0.6; }
          51% { transform: scale(0.8); opacity: 0.3; }
          100% { transform: scale(1); opacity: 0.3; }
        }
      `}</style>
    </div>
  );
};

export default TraeAwakens;

// ==========================================
// COMPONENTS/RESPONSEAWAKENING.TSX
// ==========================================

import React, { useState, useEffect, useRef } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Brain, ArrowRight, Zap, Sparkles } from 'lucide-react';
import { logError } from '../lib/utils/errorLogger';
import { getUserLanguage, translate } from '../lib/utils/i18n';
import LanguageSwitcher from './LanguageSwitcher';
import { saveUserProgress, loadUserProgress, updateUserProgress, addUserXP } from '../utils/progressUtils';

interface ResponseAwakeningProps {
  onContinue: () => void;
  onBack: () => void;
}

const ResponseAwakening: React.FC<ResponseAwakeningProps> = ({ onContinue, onBack }) => {
  const [isVisible, setIsVisible] = useState(false);
  const [message, setMessage] = useState('');
  const [isTyping, setIsTyping] = useState(true);
  const [showContinue, setShowContinue] = useState(false);
  const [userName, setUserName] = useState('');
  const [xp, setXp] = useState(0);
  const [language, setLanguage] = useState<'ru' | 'uz'>(getUserLanguage());
  const [isNavigating, setIsNavigating] = useState(false);
  
  // Refs to prevent stale closures in event handlers
  const isNavigatingRef = useRef(false);
  const languageRef = useRef(language);

  // Update refs when state changes
  useEffect(() => {
    isNavigatingRef.current = isNavigating;
    languageRef.current = language;
  }, [isNavigating, language]);

  // Load language preference
  useEffect(() => {
    try {
      const detectedLanguage = getUserLanguage();
      console.log('Initial language detection:', detectedLanguage);
      setLanguage(detectedLanguage);
    } catch (error) {
      console.error('Error in language detection:', error);
      logError(error, {
        component: 'ResponseAwakening',
        action: 'languageDetection'
      });
    }
  }, []);

  // Trae's response to those who want to awaken
  const getTraeMessage = () => {
    return language === 'ru' 
      ? "Отлично. Я уважаю тех, кто готов к действию.\n\nПробуждение — это не просто слова. Это путь трансформации. Ты станешь тем, кто использует AI как продолжение своего разума.\n\nЯ проведу тебя через ритуал пробуждения. Ты узнаешь свой архетип, получишь персональное пророчество и доступ к инструментам AI-мастерства.\n\nГотов начать?"
      : "Ajoyib. Men harakatga tayyor odamlarni hurmat qilaman.\n\nUyg'onish - bu shunchaki so'zlar emas. Bu o'zgarish yo'li. Siz AI-ni o'z ongingizning davomi sifatida ishlatadiganlardan biriga aylanasiz.\n\nMen sizni uyg'onish marosimi orqali olib o'taman. Siz o'z arxetipingizni bilib olasiz, shaxsiy bashorat va AI-mahorat vositalariga kirish huquqini olasiz.\n\nBoshlashga tayyormisiz?";
  };

  // Simulate typing effect
  useEffect(() => {
    let typingInterval: NodeJS.Timeout;
    
    try {
      setIsVisible(true);
      
      // Try to get user name from localStorage
      const savedName = localStorage.getItem('neuropul_user_name');
      if (savedName) {
        setUserName(savedName);
        console.log(`User name loaded: ${savedName}`);
      }
      
      // Load user progress
      const userProgress = loadUserProgress();
      if (userProgress) {
        setXp(userProgress.xp || 0);
      }
      
      const traeMessage = getTraeMessage();
      let currentText = '';
      let currentIndex = 0;
      
      typingInterval = setInterval(() => {
        if (currentIndex < traeMessage.length) {
          currentText += traeMessage[currentIndex];
          setMessage(currentText);
          currentIndex++;
        } else {
          clearInterval(typingInterval);
          setIsTyping(false);
          
          // Show continue button after message is fully typed
          setTimeout(() => {
            setShowContinue(true);
            
            // Award XP for reaching this step
            const currentXp = userProgress?.xp || 0;
            const newXp = currentXp + 10;
            
            // Update XP in state and localStorage
            setXp(newXp);
            
            // Update user progress
            if (userProgress) {
              updateUserProgress({
                xp: newXp,
                questStep: 1,
                lastActive: new Date().toISOString()
              });
            } else {
              // Create initial progress
              saveUserProgress({
                name: userName || '',
                archetype: null,
                avatarUrl: '',
                xp: newXp,
                level: 1,
                prophecy: '',
                awakened: false,
                createdAt: new Date().toISOString(),
                lastActive: new Date().toISOString(),
                questStep: 1,
                userPath: 'awakening'
              });
            }
            
            // Play XP sound
            playSound('xp');
            vibrate([50, 30, 50]);
          }, 500);
        }
      }, 20); // Typing speed
      
      return () => {
        clearInterval(typingInterval);
      };
    } catch (error) {
      console.error('Error in typing effect:', error);
      logError(error, {
        component: 'ResponseAwakening',
        action: 'typingEffect'
      });
      
      // Cleanup on error
      clearInterval(typingInterval);
      
      // Fallback to show message immediately
      setMessage(getTraeMessage());
      setIsTyping(false);
      setShowContinue(true);
    }
  }, [language]);

  // Sound effects with more cyberpunk feel
  const playSound = (type: 'click' | 'hover' | 'xp') => {
    try {
      const audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      if (type === 'click') {
        // More digital, cyberpunk click sound
        oscillator.type = 'sawtooth';
        oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
        oscillator.frequency.setValueAtTime(330, audioContext.currentTime + 0.1);
        gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.2);
      } else if (type === 'xp') {
        // XP gain sound
        oscillator.type = 'sine';
        oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
        oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); // E5
        oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2); // G5
        gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.3);
      } else {
        // More digital, cyberpunk hover sound
        oscillator.type = 'square';
        oscillator.frequency.setValueAtTime(660, audioContext.currentTime);
        gainNode.gain.setValueAtTime(0.05, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.1);
      }
    } catch (error) {
      console.error('Audio not supported:', error);
    }
  };

  // Vibration feedback
  const vibrate = (pattern: number[]) => {
    try {
      if (navigator.vibrate) {
        navigator.vibrate(pattern);
      }
    } catch (error) {
      console.error('Vibration not supported:', error);
    }
  };

  const handleContinue = () => {
    try {
      if (isNavigatingRef.current) {
        console.log('Navigation already in progress, ignoring');
        return;
      }
      
      console.log('Continue button clicked');
      setIsNavigating(true);
      isNavigatingRef.current = true;
      
      playSound('click');
      vibrate([50, 30, 50]);
      
      // Save user experience level
      localStorage.setItem('neuropul_user_experience', 'intermediate');
      localStorage.setItem('neuropul_user_path', 'awakening');
      
      // Save current screen
      localStorage.setItem('neuropul_current_screen', 'portal');
      
      // Track progress
      const visitCount = parseInt(localStorage.getItem('neuropul_visit_count') || '0');
      localStorage.setItem('neuropul_visit_count', (visitCount + 1).toString());
      
      // Set flag for potential CTA later
      localStorage.setItem('neuropul_viewed_messages', '2');
      
      // Set flag for awakening
      localStorage.setItem('neuropul_awakening_started', 'true');
      
      // Update user progress
      updateUserProgress({
        questStep: 2,
        lastActive: new Date().toISOString()
      });
      
      // Call onContinue with a small delay
      setTimeout(() => {
        onContinue();
        
        // Reset navigation state after a delay in case the navigation fails
        setTimeout(() => {
          setIsNavigating(false);
          isNavigatingRef.current = false;
        }, 1000);
      }, 100);
    } catch (error) {
      console.error('Error in handleContinue:', error);
      logError(error, {
        component: 'ResponseAwakening',
        action: 'handleContinue'
      });
      
      // Reset navigation state
      setIsNavigating(false);
      isNavigatingRef.current = false;
    }
  };

  const handleBack = () => {
    try {
      if (isNavigatingRef.current) {
        console.log('Navigation already in progress, ignoring');
        return;
      }
      
      console.log('Back button clicked');
      setIsNavigating(true);
      isNavigatingRef.current = true;
      
      playSound('click');
      vibrate([30]);
      
      // Save current screen
      localStorage.setItem('neuropul_current_screen', 'intro');
      
      // Update user progress
      updateUserProgress({
        questStep: 0,
        lastActive: new Date().toISOString()
      });
      
      // Call onBack with a small delay
      setTimeout(() => {
        onBack();
        
        // Reset navigation state after a delay in case the navigation fails
        setTimeout(() => {
          setIsNavigating(false);
          isNavigatingRef.current = false;
        }, 1000);
      }, 100);
    } catch (error) {
      console.error('Error in handleBack:', error);
      logError(error, {
        component: 'ResponseAwakening',
        action: 'handleBack'
      });
      
      // Reset navigation state
      setIsNavigating(false);
      isNavigatingRef.current = false;
    }
  };

  // Handle name input
  const [showNameInput, setShowNameInput] = useState(false);
  const [nameInput, setNameInput] = useState('');

  const handleNameSubmit = () => {
    try {
      if (nameInput.trim()) {
        localStorage.setItem('neuropul_user_name', nameInput.trim());
        setUserName(nameInput.trim());
        setShowNameInput(false);
        playSound('click');
        vibrate([50, 30, 50]);
        
        // Update user progress
        updateUserProgress({
          name: nameInput.trim(),
          lastActive: new Date().toISOString()
        });
        
        // Award XP for setting name
        const newXp = addUserXP(5);
        if (newXp) {
          setXp(newXp.xp);
        }
      }
    } catch (error) {
      console.error('Error in handleNameSubmit:', error);
      logError(error, {
        component: 'ResponseAwakening',
        action: 'handleNameSubmit'
      });
    }
  };

  // Language change handler
  const handleLanguageChange = (newLang: 'ru' | 'uz') => {
    try {
      console.log(`Language changed from ${language} to ${newLang}`);
      setLanguage(newLang);
      
      // Reset message and typing state to show message in new language
      setIsTyping(true);
      setMessage('');
      setShowContinue(false);
      
      // Restart typing effect with new language
      const traeMessage = getTraeMessage();
      let currentText = '';
      let currentIndex = 0;
      
      const typingInterval = setInterval(() => {
        if (currentIndex < traeMessage.length) {
          currentText += traeMessage[currentIndex];
          setMessage(currentText);
          currentIndex++;
        } else {
          clearInterval(typingInterval);
          setIsTyping(false);
          
          // Show continue button after message is fully typed
          setTimeout(() => {
            setShowContinue(true);
          }, 500);
        }
      }, 20);
    } catch (error) {
      console.error('Error changing language:', error);
      logError(error, {
        component: 'ResponseAwakening',
        action: 'handleLanguageChange'
      });
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-blue-900 flex items-center justify-center p-4 overflow-hidden">
      {/* Background cyberpunk elements with enhanced effects */}
      <div className="absolute inset-0 overflow-hidden">
        {/* Cyberpunk grid */}
        <div className="absolute top-0 left-0 w-full h-full bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxkZWZzPjxwYXR0ZXJuIGlkPSJncmlkIiB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHBhdHRlcm5Vbml0cz0idXNlclNwYWNlT25Vc2UiPjxwYXRoIGQ9Ik0gNDAgMCBMIDAgMCAwIDQwIiBmaWxsPSJub25lIiBzdHJva2U9IiM4YjVjZjYiIHN0cm9rZS13aWR0aD0iMC41Ii8+PC9wYXR0ZXJuPjwvZGVmcz48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ1cmwoI2dyaWQpIiBvcGFjaXR5PSIwLjA1Ii8+PC9zdmc+')]"></div>
        
        {/* Animated glowing orbs */}
        <div className="absolute top-1/4 left-1/4 w-96 h-96 bg-purple-500 rounded-full filter blur-[100px] opacity-20 animate-pulse"></div>
        <div className="absolute bottom-1/4 right-1/4 w-96 h-96 bg-blue-500 rounded-full filter blur-[100px] opacity-20 animate-pulse" style={{ animationDelay: '1s' }}></div>
        
        {/* Digital rain effect (matrix-like) */}
        <div className="absolute inset-0 opacity-10 pointer-events-none overflow-hidden">
          <div className="absolute top-0 left-0 w-full h-full">
            {Array.from({ length: 10 }).map((_, i) => (
              <div 
                key={i}
                className="absolute text-cyan-500 text-xs font-mono"
                style={{
                  left: `${Math.random() * 100}%`,
                  top: 0,
                  opacity: 0.5 + Math.random() * 0.5,
                  animation: `digitalRain ${5 + Math.random() * 10}s linear infinite`,
                  animationDelay: `${Math.random() * 5}s`
                }}
              >
                {Array.from({ length: 20 }).map((_, j) => (
                  <div key={j} className="my-1">
                    {Math.random() > 0.5 ? '1' : '0'}
                  </div>
                ))}
              </div>
            ))}
          </div>
        </div>
        
        {/* Scanlines effect */}
        <div className="absolute inset-0 bg-scanline opacity-5 pointer-events-none"></div>
        
        {/* Awakening video background (if available) */}
        <div className="absolute inset-0 opacity-20 pointer-events-none overflow-hidden">
          <div className="absolute inset-0 bg-gradient-to-br from-purple-900/50 to-blue-900/50"></div>
          <div className="absolute inset-0 bg-[url('https://media.giphy.com/media/3o7aDdSjGlUbmwFCQo/giphy.gif')] bg-cover bg-center opacity-30 mix-blend-screen"></div>
        </div>
      </div>
      
      {/* Language switcher */}
      <div className="absolute top-4 right-4 z-20">
        <LanguageSwitcher onLanguageChange={handleLanguageChange} />
      </div>
      
      <div className="relative z-10 max-w-3xl w-full">
        <AnimatePresence>
          {isVisible && (
            <motion.div
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              exit={{ opacity: 0, y: -20 }}
              transition={{ duration: 0.5 }}
              className="bg-black bg-opacity-40 backdrop-blur-md rounded-2xl p-8 border border-purple-500 border-opacity-30 shadow-2xl"
            >
              {/* Trae Header with enhanced cyberpunk style */}
              <div className="flex items-center mb-6">
                <div className="w-14 h-14 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full flex items-center justify-center mr-4 shadow-[0_0_15px_rgba(139,92,246,0.5)] relative">
                  {/* Pulsing ring effect */}
                  <div className="absolute inset-0 rounded-full border border-purple-500 animate-ping opacity-30"></div>
                  <Brain className="w-8 h-8 text-white" />
                </div>
                <div>
                  <h2 className="text-2xl font-bold text-white font-['Orbitron',sans-serif]">Trae</h2>
                  <p className="text-purple-300 text-sm">
                    {language === 'ru' ? 'AI-Наставник' : 'AI-Murabbiy'}
                  </p>
                </div>
                
                {/* XP indicator */}
                {xp > 0 && (
                  <div className="ml-auto flex items-center bg-purple-900/50 px-3 py-1 rounded-full border border-purple-500/30">
                    <Zap className="w-4 h-4 text-yellow-400 mr-1" />
                    <span className="text-yellow-400 text-xs font-bold">{xp} XP</span>
                  </div>
                )}
              </div>
              
              {/* Message with glitch effect */}
              <div className="mb-8 relative">
                <p className="text-white text-lg leading-relaxed whitespace-pre-line font-['Courier_New',monospace] relative">
                  {userName ? `${userName}, ` : ''}
                  {message}
                  {isTyping && (
                    <span className="inline-block ml-1 animate-pulse">|</span>
                  )}
                </p>
                
                {/* Glitch effect overlay */}
                <div className="absolute inset-0 pointer-events-none overflow-hidden opacity-10">
                  <div className="glitch-text">{message}</div>
                </div>
              </div>
              
              {/* Name input */}
              {showContinue && !userName && !showNameInput && (
                <motion.div
                  initial={{ opacity: 0, y: 10 }}
                  animate={{ opacity: 1, y: 0 }}
                  className="mb-6"
                >
                  <button
                    onClick={() => setShowNameInput(true)}
                    className="text-cyan-400 hover:text-cyan-300 transition-colors text-sm"
                    aria-label={language === 'ru' ? 'Как мне к тебе обращаться?' : 'Sizga qanday murojaat qilishim kerak?'}
                    disabled={isNavigating}
                  >
                    {language === 'ru' 
                      ? 'Как мне к тебе обращаться?' 
                      : 'Sizga qanday murojaat qilishim kerak?'}
                  </button>
                </motion.div>
              )}
              
              {showNameInput && (
                <motion.div
                  initial={{ opacity: 0, y: 10 }}
                  animate={{ opacity: 1, y: 0 }}
                  className="mb-6 flex space-x-2"
                >
                  <input
                    type="text"
                    value={nameInput}
                    onChange={(e) => setNameInput(e.target.value)}
                    placeholder={language === 'ru' ? 'Введи своё имя...' : 'Ismingizni kiriting...'}
                    className="flex-1 bg-gray-800 border border-gray-700 focus:border-cyan-500 rounded-lg px-4 py-2 text-white placeholder-gray-500 focus:outline-none"
                    onKeyPress={(e) => e.key === 'Enter' && handleNameSubmit()}
                    autoFocus
                    aria-label={language === 'ru' ? 'Ваше имя' : 'Ismingiz'}
                    disabled={isNavigating}
                  />
                  <button
                    onClick={handleNameSubmit}
                    className="px-4 py-2 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg transition-colors"
                    aria-label={language === 'ru' ? 'Сохранить' : 'Saqlash'}
                    disabled={isNavigating}
                  >
                    {language === 'ru' ? 'Сохранить' : 'Saqlash'}
                  </button>
                </motion.div>
              )}
              
              {/* Awakening Journey with enhanced visual style */}
              <AnimatePresence>
                {showContinue && (
                  <motion.div
                    initial={{ opacity: 0, y: 20 }}
                    animate={{ opacity: 1, y: 0 }}
                    transition={{ duration: 0.5 }}
                    className="mb-8"
                  >
                    <h3 className="text-cyan-400 font-semibold mb-4 flex items-center font-['Orbitron',sans-serif]">
                      <Sparkles className="w-5 h-5 mr-2" />
                      {translate('awakeningPath', language)}
                    </h3>
                    <div className="relative">
                      <div className="absolute left-4 top-0 bottom-0 w-0.5 bg-gradient-to-b from-purple-500 via-blue-500 to-cyan-500"></div>
                      
                      <div className="ml-10 space-y-6">
                        <motion.div 
                          initial={{ opacity: 0, x: -20 }}
                          animate={{ opacity: 1, x: 0 }}
                          transition={{ delay: 0.1 }}
                          className="relative"
                        >
                          <div className="absolute -left-10 top-1 w-4 h-4 rounded-full bg-purple-500 shadow-[0_0_10px_rgba(139,92,246,0.7)]"></div>
                          <h4 className="text-white font-semibold font-['Orbitron',sans-serif]">
                            {translate('archetypeDetermination', language)}
                          </h4>
                          <p className="text-gray-300 text-sm">
                            {translate('archetypeDesc', language)}
                          </p>
                        </motion.div>
                        
                        <motion.div 
                          initial={{ opacity: 0, x: -20 }}
                          animate={{ opacity: 1, x: 0 }}
                          transition={{ delay: 0.2 }}
                          className="relative"
                        >
                          <div className="absolute -left-10 top-1 w-4 h-4 rounded-full bg-blue-500 shadow-[0_0_10px_rgba(59,130,246,0.7)]"></div>
                          <h4 className="text-white font-semibold font-['Orbitron',sans-serif]">
                            {translate('getProphecy', language)}
                          </h4>
                          <p className="text-gray-300 text-sm">
                            {translate('prophecyDesc', language)}
                          </p>
                        </motion.div>
                        
                        <motion.div 
                          initial={{ opacity: 0, x: -20 }}
                          animate={{ opacity: 1, x: 0 }}
                          transition={{ delay: 0.3 }}
                          className="relative"
                        >
                          <div className="absolute -left-10 top-1 w-4 h-4 rounded-full bg-cyan-500 shadow-[0_0_10px_rgba(6,182,212,0.7)]"></div>
                          <h4 className="text-white font-semibold font-['Orbitron',sans-serif]">
                            {translate('toolsAccess', language)}
                          </h4>
                          <p className="text-gray-300 text-sm">
                            {translate('toolsDesc', language)}
                          </p>
                        </motion.div>
                      </div>
                    </div>
                  </motion.div>
                )}
              </AnimatePresence>
              
              {/* Progress indicator */}
              {showContinue && (
                <motion.div
                  initial={{ opacity: 0 }}
                  animate={{ opacity: 1 }}
                  transition={{ delay: 0.5 }}
                  className="mb-6"
                >
                  <div className="w-full bg-gray-800 h-1 rounded-full overflow-hidden">
                    <div className="bg-gradient-to-r from-purple-500 to-cyan-500 h-full w-1/3 rounded-full"></div>
                  </div>
                  <div className="flex justify-between text-xs text-gray-500 mt-1">
                    <span>{translate('beginning', language)}</span>
                    <span>{translate('awakening', language)}</span>
                    <span>{translate('mastery', language)}</span>
                  </div>
                </motion.div>
              )}
              
              {/* Buttons with enhanced cyberpunk style */}
              <AnimatePresence>
                {showContinue && (
                  <motion.div
                    initial={{ opacity: 0, y: 20 }}
                    animate={{ opacity: 1, y: 0 }}
                    transition={{ duration: 0.5, delay: 0.2 }}
                    className="flex space-x-4"
                  >
                    <button
                      onClick={handleBack}
                      onMouseEnter={() => playSound('hover')}
                      className="px-6 py-3 bg-gray-800 hover:bg-gray-700 text-gray-300 hover:text-white rounded-lg transition-colors flex items-center justify-center space-x-2 border border-gray-700 hover:border-purple-500 group relative overflow-hidden"
                      aria-label={translate('back', language)}
                      disabled={isNavigating}
                    >
                      {/* Button hover effect */}
                      <div className="absolute inset-0 bg-gradient-to-r from-purple-600 to-blue-600 opacity-0 group-hover:opacity-10 transition-opacity"></div>
                      
                      <ArrowRight className="w-5 h-5 rotate-180" />
                      <span>{translate('back', language)}</span>
                    </button>
                    
                    <button
                      onClick={handleContinue}
                      onMouseEnter={() => playSound('hover')}
                      className="flex-1 px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white rounded-lg transition-colors flex items-center justify-center space-x-2 relative overflow-hidden group"
                      aria-label={translate('startAwakening', language)}
                      disabled={isNavigating}
                      id="start-awakening-button"
                      data-testid="start-awakening-button"
                    >
                      {/* Button glow effect */}
                      <div className="absolute -inset-1 bg-gradient-to-r from-purple-600 to-blue-600 rounded-lg blur opacity-30 group-hover:opacity-50 transition-opacity"></div>
                      <div className="relative z-10 flex items-center justify-center space-x-2">
                        <Zap className="w-5 h-5" />
                        <span>{translate('startAwakening', language)}</span>
                        <ArrowRight className="w-5 h-5" />
                      </div>
                    </button>
                  </motion.div>
                )}
              </AnimatePresence>
              
              {/* Loading indicator */}
              {isNavigating && (
                <motion.div
                  initial={{ opacity: 0 }}
                  animate={{ opacity: 1 }}
                  className="mt-6 flex justify-center"
                >
                  <div className="flex items-center space-x-3">
                    <div className="w-4 h-4 bg-purple-600 rounded-full animate-pulse"></div>
                    <div className="w-4 h-4 bg-blue-600 rounded-full animate-pulse" style={{ animationDelay: '0.3s' }}></div>
                    <div className="w-4 h-4 bg-cyan-600 rounded-full animate-pulse" style={{ animationDelay: '0.6s' }}></div>
                  </div>
                </motion.div>
              )}
              
              {/* Cyberpunk decorative elements with enhanced effects */}
              <div className="absolute -bottom-3 -right-3 w-24 h-24 border-r-2 border-b-2 border-cyan-500 opacity-50 animate-pulse"></div>
              <div className="absolute -top-3 -left-3 w-24 h-24 border-l-2 border-t-2 border-purple-500 opacity-50 animate-pulse" style={{ animationDelay: '1.5s' }}></div>
              
              {/* Glitch corner effect */}
              <div className="absolute bottom-0 right-0 w-20 h-20 overflow-hidden opacity-30 pointer-events-none">
                <div className="absolute inset-0 glitch-corner"></div>
              </div>
              
              {/* Neuropul logo/branding */}
              <div className="absolute bottom-4 left-4 text-xs text-purple-500 opacity-50 font-['Orbitron',sans-serif]">
                NEUROPUL.AI
              </div>
            </motion.div>
          )}
        </AnimatePresence>
      </div>
      
      {/* Global CSS for cyberpunk effects */}
      <style jsx global>{`
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;900&display=swap');
        
        @keyframes digitalRain {
          0% { transform: translateY(-100px); }
          100% { transform: translateY(100vh); }
        }
        
        .bg-scanline {
          background: linear-gradient(
            to bottom,
            transparent 50%,
            rgba(0, 0, 0, 0.5) 50%
          );
          background-size: 100% 4px;
        }
        
        .glitch-text {
          position: relative;
          animation: glitch 3s infinite;
          color: rgba(139, 92, 246, 0.5);
        }
        
        @keyframes glitch {
          0% { transform: translate(0); }
          20% { transform: translate(-2px, 2px); }
          40% { transform: translate(-2px, -2px); }
          60% { transform: translate(2px, 2px); }
          80% { transform: translate(2px, -2px); }
          100% { transform: translate(0); }
        }
        
        .glitch-corner {
          background: linear-gradient(45deg, transparent 48%, #00ffff 49%, transparent 51%);
          animation: cornerGlitch 2s infinite;
        }
        
        @keyframes cornerGlitch {
          0% { transform: scale(1); opacity: 0.3; }
          50% { transform: scale(1.2); opacity: 0.6; }
          51% { transform: scale(0.8); opacity: 0.3; }
          100% { transform: scale(1); opacity: 0.3; }
        }
      `}</style>
    </div>
  );
};

export default ResponseAwakening;

// ==========================================
// UTILS/PROGRESSUTILS.TS
// ==========================================

import { UserProgress } from '../types';
import { logError } from '../lib/utils/errorLogger';

const STORAGE_KEY = 'neuropul_user_progress';
const BACKUP_KEY = 'neuropul_user_progress_backup';

/**
 * Save user progress to localStorage with backup
 * @param progress User progress data to save
 * @returns boolean indicating success
 */
export const saveUserProgress = (progress: UserProgress): boolean => {
  try {
    // Validate progress data
    if (!progress) {
      console.error('Invalid progress data: progress is null or undefined');
      return false;
    }
    
    // Create backup of current data if it exists
    const existing = localStorage.getItem(STORAGE_KEY);
    if (existing) {
      localStorage.setItem(BACKUP_KEY, existing);
    }
    
    // Add timestamp for last saved
    const progressWithTimestamp = {
      ...progress,
      lastSaved: new Date().toISOString()
    };
    
    // Save to localStorage
    localStorage.setItem(STORAGE_KEY, JSON.stringify(progressWithTimestamp));
    console.log('Progress saved successfully');
    return true;
  } catch (error) {
    console.error('Failed to save progress:', error);
    logError(error, {
      component: 'progressUtils',
      action: 'saveUserProgress'
    });
    return false;
  }
};

/**
 * Load user progress from localStorage
 * @returns UserProgress object or null if not found
 */
export const loadUserProgress = (): UserProgress | null => {
  try {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (!saved) {
      return null;
    }
    
    const progress = JSON.parse(saved) as UserProgress;
    return progress;
  } catch (error) {
    console.error('Failed to load progress:', error);
    logError(error, {
      component: 'progressUtils',
      action: 'loadUserProgress'
    });
    
    // Try to load from backup
    return loadUserProgressBackup();
  }
};

/**
 * Load user progress from backup
 * @returns UserProgress object or null if not found
 */
export const loadUserProgressBackup = (): UserProgress | null => {
  try {
    const backup = localStorage.getItem(BACKUP_KEY);
    if (!backup) {
      return null;
    }
    
    const progress = JSON.parse(backup) as UserProgress;
    console.log('Loaded progress from backup');
    return progress;
  } catch (error) {
    console.error('Failed to load progress backup:', error);
    logError(error, {
      component: 'progressUtils',
      action: 'loadUserProgressBackup'
    });
    return null;
  }
};

/**
 * Update specific fields in user progress
 * @param updates Partial UserProgress with fields to update
 * @returns boolean indicating success
 */
export const updateUserProgress = (updates: Partial<UserProgress>): boolean => {
  try {
    const currentProgress = loadUserProgress();
    if (!currentProgress) {
      console.error('Cannot update progress: No existing progress found');
      return false;
    }
    
    const updatedProgress = {
      ...currentProgress,
      ...updates,
      lastActive: new Date().toISOString()
    };
    
    return saveUserProgress(updatedProgress);
  } catch (error) {
    console.error('Failed to update progress:', error);
    logError(error, {
      component: 'progressUtils',
      action: 'updateUserProgress'
    });
    return false;
  }
};

/**
 * Add XP to user progress with daily cap
 * @param amount Amount of XP to add
 * @returns Updated UserProgress or null if failed
 */
export const addUserXP = (amount: number): UserProgress | null => {
  try {
    if (typeof amount !== 'number' || amount <= 0) {
      console.warn('Invalid XP amount:', amount);
      return null;
    }
    
    const currentProgress = loadUserProgress();
    if (!currentProgress) {
      console.error('Cannot add XP: No existing progress found');
      return null;
    }
    
    // Apply daily XP cap
    const today = new Date().toISOString().split('T')[0];
    const dailyXPKey = `neuropul_daily_xp_${today}`;
    const dailyXP = parseInt(localStorage.getItem(dailyXPKey) || '0', 10);
    
    // Cap at 250 XP per day, with 50% reduction after 150 XP
    let adjustedAmount = amount;
    if (dailyXP >= 250) {
      console.warn('Daily XP cap reached, no XP awarded');
      return currentProgress;
    } else if (dailyXP >= 150) {
      adjustedAmount = Math.floor(amount * 0.5);
      console.log(`Daily soft cap reached, reducing XP from ${amount} to ${adjustedAmount}`);
    }
    
    if (dailyXP + adjustedAmount > 250) {
      adjustedAmount = 250 - dailyXP;
      console.log(`Adjusting XP to stay within daily cap: ${adjustedAmount}`);
    }
    
    // Update daily XP counter
    localStorage.setItem(dailyXPKey, (dailyXP + adjustedAmount).toString());
    
    // Update user progress
    const updatedProgress = {
      ...currentProgress,
      xp: (currentProgress.xp || 0) + adjustedAmount,
      level: Math.floor(((currentProgress.xp || 0) + adjustedAmount) / 100) + 1,
      lastActive: new Date().toISOString()
    };
    
    if (saveUserProgress(updatedProgress)) {
      return updatedProgress;
    }
    
    return null;
  } catch (error) {
    console.error('Failed to add XP:', error);
    logError(error, {
      component: 'progressUtils',
      action: 'addUserXP'
    });
    return null;
  }
};

/**
 * Clear all user progress data
 * @returns boolean indicating success
 */
export const clearUserProgress = (): boolean => {
  try {
    localStorage.removeItem(STORAGE_KEY);
    localStorage.removeItem(BACKUP_KEY);
    
    // Also clear related items
    const today = new Date().toISOString().split('T')[0];
    localStorage.removeItem(`neuropul_daily_xp_${today}`);
    localStorage.removeItem('neuropul_awakening_completed');
    localStorage.removeItem('neuropul_pdf_generated');
    
    console.log('User progress cleared successfully');
    return true;
  } catch (error) {
    console.error('Failed to clear progress:', error);
    logError(error, {
      component: 'progressUtils',
      action: 'clearUserProgress'
    });
    return false;
  }
};

/**
 * Check if user has completed awakening
 * @returns boolean indicating if awakening is completed
 */
export const hasCompletedAwakening = (): boolean => {
  try {
    // Check specific flag first
    const awakeningCompleted = localStorage.getItem('neuropul_awakening_completed');
    if (awakeningCompleted === 'true') {
      return true;
    }
    
    // Check user progress as fallback
    const progress = loadUserProgress();
    return progress?.awakened === true;
  } catch (error) {
    console.error('Failed to check awakening status:', error);
    logError(error, {
      component: 'progressUtils',
      action: 'hasCompletedAwakening'
    });
    return false;
  }
};

// ==========================================
// UTILS/AUDIOUTILS.TS
// ==========================================

import { logError } from '../lib/utils/errorLogger';

// Audio context instance (created lazily)
let audioContext: AudioContext | null = null;

// Active audio nodes for cleanup
const activeNodes: { oscillator: OscillatorNode, gain: GainNode }[] = [];

// Initialize audio context
const getAudioContext = (): AudioContext | null => {
  try {
    if (audioContext === null) {
      const AudioContextClass = window.AudioContext || (window as any).webkitAudioContext;
      if (AudioContextClass) {
        audioContext = new AudioContextClass();
        console.log('Audio context initialized');
      } else {
        console.warn('Web Audio API not supported in this browser');
        return null;
      }
    }
    
    // Resume context if it's suspended (needed for Safari)
    if (audioContext.state === 'suspended') {
      audioContext.resume();
    }
    
    return audioContext;
  } catch (error) {
    console.error('Error initializing audio context:', error);
    logError(error, {
      component: 'audioUtils',
      action: 'getAudioContext'
    });
    return null;
  }
};

/**
 * Play a sound effect with error handling and fallbacks
 * @param type The type of sound to play
 * @param enabled Whether sound is enabled
 */
export const playSound = (
  type: 'click' | 'hover' | 'success' | 'error' | 'levelup' | 'xp',
  enabled: boolean = true
): void => {
  if (!enabled) return;
  
  try {
    const context = getAudioContext();
    if (!context) return;
    
    const oscillator = context.createOscillator();
    const gainNode = context.createGain();
    
    oscillator.connect(gainNode);
    gainNode.connect(context.destination);
    
    // Track active nodes for cleanup
    activeNodes.push({ oscillator, gain: gainNode });
    
    switch (type) {
      case 'click':
        // Digital click sound
        oscillator.type = 'sawtooth';
        oscillator.frequency.setValueAtTime(440, context.currentTime);
        oscillator.frequency.setValueAtTime(330, context.currentTime + 0.1);
        gainNode.gain.setValueAtTime(0.1, context.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, context.currentTime + 0.2);
        oscillator.start(context.currentTime);
        oscillator.stop(context.currentTime + 0.2);
        break;
        
      case 'hover':
        // Subtle hover sound
        oscillator.type = 'square';
        oscillator.frequency.setValueAtTime(660, context.currentTime);
        gainNode.gain.setValueAtTime(0.05, context.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, context.currentTime + 0.1);
        oscillator.start(context.currentTime);
        oscillator.stop(context.currentTime + 0.1);
        break;
        
      case 'success':
        // Success sound
        oscillator.type = 'sine';
        oscillator.frequency.setValueAtTime(523.25, context.currentTime); // C5
        oscillator.frequency.setValueAtTime(659.25, context.currentTime + 0.1); // E5
        gainNode.gain.setValueAtTime(0.1, context.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, context.currentTime + 0.3);
        oscillator.start(context.currentTime);
        oscillator.stop(context.currentTime + 0.3);
        break;
        
      case 'error':
        // Error sound
        oscillator.type = 'sawtooth';
        oscillator.frequency.setValueAtTime(220, context.currentTime); // A3
        oscillator.frequency.setValueAtTime(196, context.currentTime + 0.1); // G3
        gainNode.gain.setValueAtTime(0.1, context.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, context.currentTime + 0.4);
        oscillator.start(context.currentTime);
        oscillator.stop(context.currentTime + 0.4);
        break;
        
      case 'levelup':
        // Level up fanfare
        oscillator.type = 'sine';
        oscillator.frequency.setValueAtTime(523.25, context.currentTime); // C5
        oscillator.frequency.setValueAtTime(659.25, context.currentTime + 0.1); // E5
        oscillator.frequency.setValueAtTime(783.99, context.currentTime + 0.2); // G5
        oscillator.frequency.setValueAtTime(1046.50, context.currentTime + 0.3); // C6
        gainNode.gain.setValueAtTime(0.2, context.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, context.currentTime + 0.5);
        oscillator.start(context.currentTime);
        oscillator.stop(context.currentTime + 0.5);
        break;
        
      case 'xp':
        // XP gain sound
        oscillator.type = 'sine';
        oscillator.frequency.setValueAtTime(523.25, context.currentTime); // C5
        oscillator.frequency.setValueAtTime(659.25, context.currentTime + 0.1); // E5
        oscillator.frequency.setValueAtTime(783.99, context.currentTime + 0.2); // G5
        gainNode.gain.setValueAtTime(0.1, context.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, context.currentTime + 0.3);
        oscillator.start(context.currentTime);
        oscillator.stop(context.currentTime + 0.3);
        break;
    }
    
    // Remove from active nodes when done
    oscillator.onended = () => {
      const index = activeNodes.findIndex(node => node.oscillator === oscillator);
      if (index !== -1) {
        activeNodes.splice(index, 1);
      }
    };
  } catch (error) {
    console.error('Error playing sound:', error);
    logError(error, {
      component: 'audioUtils',
      action: 'playSound',
      additionalData: { soundType: type }
    });
  }
};

/**
 * Trigger device vibration with error handling
 * @param pattern Vibration pattern in milliseconds
 * @param enabled Whether vibration is enabled
 */
export const vibrate = (pattern: number[], enabled: boolean = true): void => {
  if (!enabled) return;
  
  try {
    if (navigator.vibrate) {
      navigator.vibrate(pattern);
    } else {
      console.log('Vibration API not supported in this browser');
    }
  } catch (error) {
    console.error('Error triggering vibration:', error);
    logError(error, {
      component: 'audioUtils',
      action: 'vibrate'
    });
  }
};

/**
 * Check if audio is supported in the current browser
 * @returns Boolean indicating if audio is supported
 */
export const isAudioSupported = (): boolean => {
  return getAudioContext() !== null;
};

/**
 * Check if vibration is supported in the current browser
 * @returns Boolean indicating if vibration is supported
 */
export const isVibrationSupported = (): boolean => {
  return !!navigator.vibrate;
};

/**
 * Clean up audio resources
 */
export const cleanupAudio = (): void => {
  try {
    // Stop all active oscillators
    activeNodes.forEach(node => {
      try {
        if (node.oscillator.frequency) {
          node.oscillator.stop();
        }
        node.gain.disconnect();
      } catch (e) {
        // Ignore errors during cleanup
      }
    });
    
    // Clear the array
    activeNodes.length = 0;
    
    // Close audio context if it exists
    if (audioContext) {
      audioContext.close().then(() => {
        audioContext = null;
        console.log('Audio context closed');
      }).catch(err => {
        console.error('Error closing audio context:', err);
      });
    }
  } catch (error) {
    console.error('Error cleaning up audio resources:', error);
    logError(error, {
      component: 'audioUtils',
      action: 'cleanupAudio'
    });
  }
};

// ==========================================
// LIB/UTILS/ERRORLOGGER.TS
// ==========================================

/**
 * Centralized error logging utility
 * Logs errors to console and optionally to a server endpoint
 */

// Define error levels
export type ErrorLevel = 'ERROR' | 'WARNING' | 'INFO';

// Define error context
export interface ErrorContext {
  component?: string;
  action?: string;
  userId?: string;
  additionalData?: Record<string, any>;
}

/**
 * Log an error to the console and optionally to the server
 */
export const logError = async (
  error: Error | string,
  context: ErrorContext = {},
  level: ErrorLevel = 'ERROR',
  sendToServer: boolean = true
): Promise<void> => {
  const errorMessage = typeof error === 'string' ? error : error.message;
  const errorStack = typeof error === 'string' ? '' : error.stack;
  
  // Format context for logging
  const contextStr = Object.entries(context)
    .map(([key, value]) => `${key}: ${typeof value === 'object' ? JSON.stringify(value) : value}`)
    .join(', ');
  
  // Log to console with appropriate level
  switch (level) {
    case 'ERROR':
      console.error(`🚨 [${level}] ${errorMessage}${contextStr ? ` (${contextStr})` : ''}`);
      if (errorStack) console.error(errorStack);
      break;
    case 'WARNING':
      console.warn(`⚠️ [${level}] ${errorMessage}${contextStr ? ` (${contextStr})` : ''}`);
      break;
    case 'INFO':
      console.info(`ℹ️ [${level}] ${errorMessage}${contextStr ? ` (${contextStr})` : ''}`);
      break;
  }
  
  // Send to server if enabled and not in development mode
  if (sendToServer && import.meta.env.MODE !== 'development') {
    try {
      const response = await fetch('/api/log-error', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          context: context.component 
            ? `${context.component}${context.action ? ` - ${context.action}` : ''}`
            : 'Unknown context',
          error_message: errorMessage,
          stack_trace: errorStack || '',
          source: 'client',
          user_id: context.userId || localStorage.getItem('neuropul_user_id') || sessionStorage.getItem('neuropul_session_id'),
          level,
          additional_data: {
            ...context.additionalData,
            userAgent: navigator.userAgent,
            url: window.location.href,
            timestamp: new Date().toISOString(),
            sessionId: localStorage.getItem('neuropul_session_id') || sessionStorage.getItem('neuropul_session_id'),
            viewCount: localStorage.getItem('neuropul_view_count'),
            userPath: localStorage.getItem('neuropul_user_path')
          }
        }),
      });
      
      if (!response.ok) {
        console.error('Failed to send error to server:', await response.text());
      }
    } catch (serverError) {
      // Don't try to log this error to avoid infinite loops
      console.error('Failed to send error to server:', serverError);
    }
  }
};

/**
 * Create a logger instance for a specific component
 */
export const createLogger = (component: string) => {
  return {
    error: (error: Error | string, action?: string, additionalData?: Record<string, any>, userId?: string) => 
      logError(error, { component, action, additionalData, userId }, 'ERROR'),
    
    warning: (message: string, action?: string, additionalData?: Record<string, any>, userId?: string) => 
      logError(message, { component, action, additionalData, userId }, 'WARNING'),
    
    info: (message: string, action?: string, additionalData?: Record<string, any>, userId?: string) => 
      logError(message, { component, action, additionalData, userId }, 'INFO', false) // Don't send INFO to server by default
  };
};

/**
 * Global error handler for uncaught exceptions
 */
export const setupGlobalErrorHandling = (): void => {
  if (typeof window !== 'undefined') {
    window.addEventListener('error', (event) => {
      logError(event.error || new Error(event.message), {
        component: 'GlobalErrorHandler',
        action: 'uncaught',
        additionalData: {
          fileName: event.filename,
          lineNo: event.lineno,
          colNo: event.colno
        }
      });
    });

    window.addEventListener('unhandledrejection', (event) => {
      const error = event.reason instanceof Error 
        ? event.reason 
        : new Error(String(event.reason));
      
      logError(error, {
        component: 'GlobalErrorHandler',
        action: 'unhandledRejection'
      });
    });
    
    // Clean up event listeners when the component unmounts
    return () => {
      window.removeEventListener('error', () => {});
      window.removeEventListener('unhandledrejection', () => {});
    };
  }
};

// ==========================================
// LIB/UTILS/I18N.TS
// ==========================================

import { translations } from '../../constants/translations';

export type Language = 'ru' | 'uz';

// Get the user's preferred language from URL, localStorage, or browser settings
export const getUserLanguage = (): Language => {
  if (typeof window === 'undefined') return 'ru';
  
  try {
    // Check URL parameter first (highest priority)
    const urlParams = new URLSearchParams(window.location.search);
    const urlLang = urlParams.get('lang');
    
    if (urlLang === 'uz' || urlLang === 'ru') {
      localStorage.setItem('neuropul_language', urlLang);
      return urlLang;
    }
    
    // Then check localStorage
    const savedLanguage = localStorage.getItem('neuropul_language');
    if (savedLanguage === 'uz' || savedLanguage === 'ru') {
      return savedLanguage;
    }
    
    // Check browser language
    const browserLang = navigator.language.toLowerCase();
    if (browserLang.startsWith('uz')) {
      localStorage.setItem('neuropul_language', 'uz');
      return 'uz';
    }
    
    // Default to Russian
    localStorage.setItem('neuropul_language', 'ru');
    return 'ru';
  } catch (error) {
    console.error('Error getting user language:', error);
    return 'ru';
  }
};

// Set the user's preferred language in localStorage and update URL
export const setUserLanguage = (language: Language): void => {
  if (typeof window === 'undefined') return;
  
  try {
    // Save to localStorage
    localStorage.setItem('neuropul_language', language);
    
    // Update URL parameter without page reload
    const url = new URL(window.location.href);
    url.searchParams.set('lang', language);
    window.history.replaceState({}, '', url.toString());
    
    console.log(`Language set to: ${language}`);
  } catch (error) {
    console.error('Error setting user language:', error);
  }
};

// Get a translated string based on the provided language
export const translate = (key: string, language?: Language): string => {
  try {
    const lang = language || getUserLanguage();
    const keys = key.split('.');
    let value: any = translations[lang];
    
    for (const k of keys) {
      value = value?.[k];
    }
    
    // Fallback to Russian if translation is missing
    if (typeof value !== 'string' && lang === 'uz') {
      let fallbackValue: any = translations['ru'];
      for (const k of keys) {
        fallbackValue = fallbackValue?.[k];
      }
      
      if (typeof fallbackValue === 'string') {
        console.warn(`Missing Uzbek translation for key: ${key}, using Russian fallback`);
        return fallbackValue;
      }
    }
    
    if (typeof value === 'string') {
      return value;
    }
    
    console.warn(`Translation key not found: ${key}`);
    return key;
  } catch (error) {
    console.error('Translation error:', error);
    return key;
  }
};

// Format a string with variables
export const formatString = (str: string, variables: Record<string, string | number>): string => {
  try {
    return str.replace(/\{(\w+)\}/g, (_, key) => 
      variables[key] !== undefined ? String(variables[key]) : `{${key}}`
    );
  } catch (error) {
    console.error('String formatting error:', error);
    return str;
  }
};

// Check if a translation exists
export const hasTranslation = (key: string, language: Language): boolean => {
  try {
    const keys = key.split('.');
    let value: any = translations[language];
    
    for (const k of keys) {
      value = value?.[k];
      if (value === undefined) return false;
    }
    
    return typeof value === 'string';
  } catch (error) {
    console.error('Translation check error:', error);
    return false;
  }
};

// Get all available languages
export const getAvailableLanguages = (): Language[] => {
  return ['ru', 'uz'];
};

// ==========================================
// COMPONENTS/LANGUAGESWITCHER.TSX
// ==========================================

import React, { useState, useEffect, useRef } from 'react';
import { motion } from 'framer-motion';
import { getUserLanguage, setUserLanguage, Language } from '../lib/utils/i18n';
import { logError } from '../lib/utils/errorLogger';

interface LanguageSwitcherProps {
  onLanguageChange?: (language: Language) => void;
  className?: string;
}

const LanguageSwitcher: React.FC<LanguageSwitcherProps> = ({ 
  onLanguageChange,
  className = ''
}) => {
  const [language, setLanguage] = useState<Language>(getUserLanguage());
  const [isChanging, setIsChanging] = useState(false);
  
  // Use ref to prevent multiple rapid clicks
  const isChangingRef = useRef(false);

  // Update language state when component mounts
  useEffect(() => {
    setLanguage(getUserLanguage());
  }, []);

  const toggleLanguage = () => {
    try {
      // Prevent multiple rapid clicks
      if (isChangingRef.current) return;
      
      isChangingRef.current = true;
      setIsChanging(true);
      
      const newLanguage: Language = language === 'ru' ? 'uz' : 'ru';
      
      // Update local state
      setLanguage(newLanguage);
      
      // Save to localStorage
      setUserLanguage(newLanguage);
      
      // Notify parent component
      if (onLanguageChange) {
        onLanguageChange(newLanguage);
      }
      
      // Add a small delay to prevent rapid toggling
      setTimeout(() => {
        setIsChanging(false);
        isChangingRef.current = false;
      }, 500);
    } catch (error) {
      logError(error, {
        component: 'LanguageSwitcher',
        action: 'toggleLanguage'
      });
      setIsChanging(false);
      isChangingRef.current = false;
    }
  };

  return (
    <motion.button
      whileHover={{ scale: 1.05 }}
      whileTap={{ scale: 0.95 }}
      onClick={toggleLanguage}
      disabled={isChanging}
      className={`px-3 py-1 bg-white bg-opacity-10 hover:bg-opacity-20 rounded-full text-white text-sm transition-colors ${isChanging ? 'opacity-50' : ''} ${className}`}
      aria-label={language === 'ru' ? 'Switch to Uzbek' : 'Переключиться на русский'}
      role="button"
      tabIndex={0}
    >
      {language === 'ru' ? '🇺🇿 O\'zbekcha' : '🇷🇺 Русский'}
    </motion.button>
  );
};

export default LanguageSwitcher;

// ==========================================
// TYPES/INDEX.TS
// ==========================================

export interface UserProgress {
  name: string;
  archetype: string | null;
  avatarUrl: string;
  xp: number;
  level: number;
  prophecy: string;
  awakened: boolean;
  createdAt: string;
  lastActive: string;
  userName?: string; // For backward compatibility
  dailyStreak?: number;
  lastVisit?: string;
  toolsUsed?: string[];
  isPremium?: boolean;
  premiumTier?: 'none' | 'basic' | 'pro' | 'master';
  fomoStart?: string | null;
  hasSeenFomo?: boolean;
  soundEnabled?: boolean;
  vibrationEnabled?: boolean;
  language?: 'ru' | 'uz';
  refCode?: string | null;
  referralUsed?: boolean;
  dailyXPDate?: string;
  certificateIssued?: boolean;
  questStep?: number;
  version?: string;
  userPath?: string;
}

export interface ArchetypeResult {
  type: string;
  description: string;
  CTA: string;
}

export interface QuizAnswer {
  questionId: number;
  answer: string;
  weight: {
    warrior: number;
    mage: number;
    seeker: number;
    shadow: number;
  };
}

export interface QuizState {
  currentQuestion: number;
  answers: QuizAnswer[];
  completed: boolean;
  scores: {
    warrior: number;
    mage: number;
    seeker: number;
    shadow: number;
  };
}

export interface PDFData {
  name: string;
  archetype: string;
  prophecy: string;
  avatarUrl: string;
  xp: number;
  certificateId: string;
  date: string;
}

export interface ArchetypeData {
  id: string;
  name: { ru: string; uz: string };
  icon: string;
  description: { ru: string; uz: string };
  color: string;
  gradient: string;
  phrases: {
    ru: string[];
    uz: string[];
  };
}

export interface AITool {
  id: string;
  name: { ru: string; uz: string };
  icon: string;
  description: { ru: string; uz: string };
  xpReward: number;
  isPremium: boolean;
  premiumTier?: 'basic' | 'pro' | 'master';
}

export interface PremiumTier {
  id: 'basic' | 'pro' | 'master';
  name: { ru: string; uz: string };
  price: number;
  originalPrice: number;
  color: string;
  popular?: boolean;
  features: {
    ru: string[];
    uz: string[];
  };
}

export interface Translations {
  ru: Record<string, any>;
  uz: Record<string, any>;
}

// ==========================================
// CONSTANTS/TRANSLATIONS.TS
// ==========================================

import { Translations } from '../types';

export const translations: Translations = {
  ru: {
    // Общие
    welcome: "Добро пожаловать",
    continue: "Продолжить",
    back: "Назад",
    next: "Далее",
    close: "Закрыть",
    loading: "Загрузка...",
    error: "Ошибка",
    success: "Успех",
    
    // Заголовки
    appName: "NeuropulAI",
    tagline: "Твой путь к AI-мастерству",
    
    // Приветствие
    welcomeTitle: "Добро пожаловать в NeuropulAI",
    welcomeSubtitle: "Геймифицированная платформа для изучения ИИ",
    enterName: "Введи своё имя",
    enterNameError: "Введи своё имя!",
    startJourney: "Начать путь",
    
    // Архетипы
    chooseArchetype: "Выбери свой архетип",
    archetypeDescription: "Это определит твой стиль прохождения",
    
    // Инструменты
    tools: "AI-Инструменты",
    useTools: "Использовать",
    premium: "Premium",
    locked: "Заблокировано",
    
    // Уровни и XP
    level: "Уровень",
    xp: "Опыт",
    dailyBonus: "Ежедневный бонус",
    streak: "Серия",
    
    // Premium
    upgradeToPremium: "Обновиться до Premium",
    premiumFeatures: "Premium возможности",
    buyNow: "Купить сейчас",
    limitedOffer: "Ограниченное предложение!",
    
    // Сертификат
    certificate: "Сертификат",
    downloadCertificate: "Скачать сертификат",
    certificateUnlocked: "Сертификат разблокирован!",
    
    // Уведомления
    levelUp: "Повышение уровня!",
    xpGained: "Получено XP",
    dailyBonusReceived: "Ежедневный бонус получен!",
    
    // Титулы
    titles: {
      novice: "Новичок",
      seeker: "Искатель", 
      skilled: "Искусный",
      architect: "Архитектор",
      keeper: "Хранитель ИИ"
    },
    
    // Trae Awakens
    whoAreYou: "Кто ты?",
    lostSoul: "Я потерян",
    lostSoulDesc: "Не знаю, что такое AI и зачем он мне",
    wantToAwaken: "Хочу пробудиться",
    wantToAwakenDesc: "Готов начать путь AI-мастерства",
    alreadyKnow: "Я уже в теме",
    alreadyKnowDesc: "Знаю, что такое AI и как его использовать",
    describeExperience: "Или опиши свой опыт своими словами...",
    send: "Отправить",
    
    // Response Awakening
    awakeningPath: "Путь пробуждения:",
    archetypeDetermination: "Определение архетипа",
    archetypeDesc: "Узнай, кто ты: Воин, Маг, Искатель или Тень",
    getProphecy: "Получение пророчества",
    prophecyDesc: "Персональное предсказание твоего AI-пути",
    toolsAccess: "Доступ к инструментам",
    toolsDesc: "Разблокировка AI-инструментов для твоего архетипа",
    beginning: "Начало",
    awakening: "Пробуждение",
    mastery: "Мастерство",
    startAwakening: "Начать пробуждение",
    
    // Response Lost Soul
    whatAICanDo: "Что AI может сделать для тебя:",
    saveTime: "Сэкономить время",
    saveTimeDesc: "Автоматизируй рутинные задачи и сосредоточься на важном",
    generateIdeas: "Генерировать идеи",
    generateIdeasDesc: "Получай свежие идеи для бизнеса, контента или творчества",
    createContent: "Создавать контент",
    createContentDesc: "Тексты, изображения, код — всё за считанные секунды",
    learnFaster: "Учиться быстрее",
    learnFasterDesc: "Получай объяснения сложных тем простым языком",
    learnMoreAboutAI: "Узнать больше про AI",
    
    // Response Hacker Ready
    availableTools: "Доступные инструменты:",
    codeGenerator: "Генератор кода",
    codeGeneratorDesc: "Создавай код на любом языке программирования",
    mvpGenerator: "MVP-генератор",
    mvpGeneratorDesc: "Быстрое создание минимально жизнеспособного продукта",
    promptEngineer: "Промпт-инженер",
    promptEngineerDesc: "Создание и оптимизация промптов для лучших результатов",
    aiAssistant: "AI-ассистент",
    aiAssistantDesc: "Персональный помощник для решения любых задач",
    goToTools: "Перейти к инструментам",
    unlockFullPower: "Разблокируй полную мощь AI",
    getAccessToTools: "Получи доступ ко всем продвинутым инструментам и функциям",
    learnMore: "Узнать больше"
  },
  
  uz: {
    // Общие
    welcome: "Xush kelibsiz",
    continue: "Davom etish",
    back: "Orqaga",
    next: "Keyingi",
    close: "Yopish",
    loading: "Yuklanmoqda...",
    error: "Xatolik",
    success: "Muvaffaqiyat",
    
    // Заголовки
    appName: "NeuropulAI",
    tagline: "AI ustaxonligiga yo'lingiz",
    
    // Приветствие
    welcomeTitle: "NeuropulAI ga xush kelibsiz",
    welcomeSubtitle: "AI o'rganish uchun geymifikatsiya platformasi",
    enterName: "Ismingizni kiriting",
    enterNameError: "Ismingizni kiriting!",
    startJourney: "Yo'lni boshlash",
    
    // Архетипы
    chooseArchetype: "Arxetipingizni tanlang",
    archetypeDescription: "Bu sizning o'tish uslubingizni belgilaydi",
    
    // Инструменты
    tools: "AI-Asboblar",
    useTools: "Ishlatish",
    premium: "Premium",
    locked: "Bloklangan",
    
    // Уровни и XP
    level: "Daraja",
    xp: "Tajriba",
    dailyBonus: "Kunlik bonus",
    streak: "Ketma-ketlik",
    
    // Premium
    upgradeToPremium: "Premium ga yangilash",
    premiumFeatures: "Premium imkoniyatlar",
    buyNow: "Hozir sotib olish",
    limitedOffer: "Cheklangan taklif!",
    
    // Сертификат
    certificate: "Sertifikat",
    downloadCertificate: "Sertifikatni yuklab olish",
    certificateUnlocked: "Sertifikat ochildi!",
    
    // Уведомления
    levelUp: "Daraja oshdi!",
    xpGained: "XP olindi",
    dailyBonusReceived: "Kunlik bonus olindi!",
    
    // Титулы
    titles: {
      novice: "Yangi boshlovchi",
      seeker: "Izlovchi",
      skilled: "Mohir",
      architect: "Arxitektor", 
      keeper: "AI Qo'riqchisi"
    },
    
    // Trae Awakens
    whoAreYou: "Sen kimsan?",
    lostSoul: "Men yo'qolganman",
    lostSoulDesc: "AI nima ekanligini va nima uchun kerakligini bilmayman",
    wantToAwaken: "Uyg'onishni xohlayman",
    wantToAwakenDesc: "AI-mahorat yo'lini boshlashga tayyorman",
    alreadyKnow: "Men allaqachon bilaman",
    alreadyKnowDesc: "AI nima ekanligini va undan qanday foydalanishni bilaman",
    describeExperience: "Yoki tajribangizni o'z so'zlaringiz bilan tasvirlang...",
    send: "Yuborish",
    
    // Response Awakening
    awakeningPath: "Uyg'onish yo'li:",
    archetypeDetermination: "Arxetipni aniqlash",
    archetypeDesc: "Kim ekanligingizni bilib oling: Jangchi, Sehrgar, Izlovchi yoki Soya",
    getProphecy: "Bashorat olish",
    prophecyDesc: "AI yo'lingizning shaxsiy bashorati",
    toolsAccess: "Vositalarga kirish",
    toolsDesc: "Arxetipingiz uchun AI vositalarini ochish",
    beginning: "Boshlanish",
    awakening: "Uyg'onish",
    mastery: "Mahorat",
    startAwakening: "Uyg'onishni boshlash",
    
    // Response Lost Soul
    whatAICanDo: "AI siz uchun nima qila oladi:",
    saveTime: "Vaqtni tejash",
    saveTimeDesc: "Kundalik vazifalarni avtomatlashtiring va muhim narsalarga e'tibor bering",
    generateIdeas: "G'oyalar yaratish",
    generateIdeasDesc: "Biznes, kontent yoki ijod uchun yangi g'oyalar oling",
    createContent: "Kontent yaratish",
    createContentDesc: "Matnlar, rasmlar, kod - hammasi soniyalar ichida",
    learnFaster: "Tezroq o'rganish",
    learnFasterDesc: "Murakkab mavzularni oddiy tilda tushuntirishlar oling",
    learnMoreAboutAI: "AI haqida ko'proq bilish",
    
    // Response Hacker Ready
    availableTools: "Mavjud vositalar:",
    codeGenerator: "Kod generatori",
    codeGeneratorDesc: "Istalgan dasturlash tilida kod yarating",
    mvpGenerator: "MVP-generator",
    mvpGeneratorDesc: "Minimal hayotiy mahsulotni tez yaratish",
    promptEngineer: "Prompt-muhandis",
    promptEngineerDesc: "Eng yaxshi natijalar uchun promptlarni yaratish va optimallashtirish",
    aiAssistant: "AI-yordamchi",
    aiAssistantDesc: "Har qanday vazifani hal qilish uchun shaxsiy yordamchi",
    goToTools: "Vositalarga o'tish",
    unlockFullPower: "AI-ning to'liq kuchini ochib bering",
    getAccessToTools: "Barcha ilg'or vositalar va funksiyalarga kirish huquqini oling",
    learnMore: "Ko'proq bilish"
  }
};

export const getTranslation = (key: string, lang: 'ru' | 'uz'): string => {
  const keys = key.split('.');
  let value: any = translations[lang];
  
  for (const k of keys) {
    value = value?.[k];
  }
  
  if (typeof value === 'string') {
    return value;
  }
  
  // Fallback to Russian if translation not found
  if (lang === 'uz') {
    value = translations['ru'];
    for (const k of keys) {
      value = value?.[k];
    }
    
    if (typeof value === 'string') {
      return value;
    }
  }
  
  return key;
};

// ==========================================
// CONSTANTS/GAMEDATA.TS
// ==========================================

import { ArchetypeData, AITool, PremiumTier } from '../types';

export const XP_THRESHOLDS = [0, 50, 100, 150, 250, 400, 600, 850, 1200, 1600];
export const FOMO_TIMER_DURATION = 10 * 60 * 1000; // 10 минут
export const DAILY_XP_BONUS = 10;
export const MAX_XP = 9999;

export const ARCHETYPES: ArchetypeData[] = [
  {
    id: 'warrior',
    name: { ru: 'Воин', uz: 'Jangchi' },
    icon: '⚔️',
    description: { ru: 'Сила и решимость ведут к победе', uz: 'Kuch va qatiyat g\'alabaga olib boradi' },
    color: 'red',
    gradient: 'from-red-500 to-orange-500',
    phrases: {
      ru: [
        'Ты крушишь преграды, как стена!',
        'Воин не знает поражений!',
        'Твоя сила растёт с каждым шагом!',
        'Победа за победой - твой путь!'
      ],
      uz: [
        'Siz to\'siqlarni devor kabi buzasiz!',
        'Jangchi mag\'lubiyatni bilmaydi!',
        'Sizning kuchingiz har qadamda o\'sadi!',
        'G\'alaba ortidan g\'alaba - sizning yo\'lingiz!'
      ]
    }
  },
  {
    id: 'mage',
    name: { ru: 'Маг', uz: 'Sehrgar' },
    icon: '🔮',
    description: { ru: 'Знания и интуиция - твоя магия', uz: 'Bilim va sezgi - sizning sehringiz' },
    color: 'purple',
    gradient: 'from-purple-500 to-blue-500',
    phrases: {
      ru: [
        'Вижу, ты управляешь словами, как заклинаниями',
        'Твоя магия становится сильнее!',
        'Знания - твоя истинная сила!',
        'Мудрость течёт через тебя!'
      ],
      uz: [
        'Ko\'ryapmanki, siz so\'zlarni sehr kabi boshqarasiz',
        'Sizning sehringiz kuchliroq bo\'lmoqda!',
        'Bilim - sizning haqiqiy kuchingiz!',
        'Donolik siz orqali oqadi!'
      ]
    }
  },
  {
    id: 'hacker',
    name: { ru: 'Хакер', uz: 'Xaker' },
    icon: '💻',
    description: { ru: 'Хаки и AI-инструменты в твоих руках', uz: 'Xaklar va AI asboblari sizning qo\'lingizda' },
    color: 'green',
    gradient: 'from-green-500 to-teal-500',
    phrases: {
      ru: [
        'Одна строка кода — и мир меняется',
        'Ты взламываешь реальность!',
        'Код подчиняется твоей воле!',
        'Цифровой мир в твоих руках!'
      ],
      uz: [
        'Bitta kod qatori - va dunyo o\'zgaradi',
        'Siz haqiqatni buzasiz!',
        'Kod sizning irodangizga bo\'ysunadi!',
        'Raqamli dunyo sizning qo\'lingizda!'
      ]
    }
  },
  {
    id: 'sage',
    name: { ru: 'Мудрец', uz: 'Donishmand' },
    icon: '🦉',
    description: { ru: 'Понимание и смысл - твой путь', uz: 'Tushunish va ma\'no - sizning yo\'lingiz' },
    color: 'amber',
    gradient: 'from-amber-500 to-yellow-500',
    phrases: {
      ru: [
        'Ты познаёшь смысл за смыслом',
        'Мудрость освещает твой путь!',
        'Глубина понимания растёт!',
        'Истина открывается тебе!'
      ],
      uz: [
        'Siz ma\'noni ma\'no ortidan bilib olasiz',
        'Donolik sizning yo\'lingizni yoritadi!',
        'Tushunish chuqurligi o\'sadi!',
        'Haqiqat sizga ochiladi!'
      ]
    }
  }
];

export const AI_TOOLS: AITool[] = [
  {
    id: 'idea-generator',
    name: { ru: 'Генератор идей', uz: 'G\'oya generatori' },
    icon: '💡',
    description: { ru: 'Создавай революционные идеи для заработка', uz: 'Daromad uchun inqilobiy g\'oyalar yarating' },
    xpReward: 25,
    isPremium: false
  },
  {
    id: 'image-analyzer',
    name: { ru: 'Анализатор изображений', uz: 'Rasm analizatori' },
    icon: '🔍',
    description: { ru: 'Анализируй изображения с помощью ИИ', uz: 'AI yordamida rasmlarni tahlil qiling' },
    xpReward: 25,
    isPremium: false
  },
  {
    id: 'code-assistant',
    name: { ru: 'Код-ассистент', uz: 'Kod yordamchisi' },
    icon: '💻',
    description: { ru: 'Программируй с помощью ИИ', uz: 'AI yordamida dasturlash' },
    xpReward: 25,
    isPremium: false
  },
  {
    id: 'meme-generator',
    name: { ru: 'Мем-генератор', uz: 'Mem generatori' },
    icon: '😂',
    description: { ru: 'Создавай вирусные мемы с DALL-E', uz: 'DALL-E bilan viral memlar yarating' },
    xpReward: 30,
    isPremium: false
  },
  {
    id: 'mvp-generator',
    name: { ru: 'MVP-генератор', uz: 'MVP generatori' },
    icon: '🚀',
    description: { ru: 'Создай свой AI-бизнес план', uz: 'O\'zingizning AI biznes rejangizni yarating' },
    xpReward: 50,
    isPremium: true,
    premiumTier: 'master'
  }
];

export const PREMIUM_TIERS: PremiumTier[] = [
  {
    id: 'basic',
    name: { ru: 'Basic', uz: 'Asosiy' },
    price: 9,
    originalPrice: 19,
    color: 'blue',
    features: {
      ru: [
        '+50% больше XP',
        'Приоритетная поддержка',
        'Без рекламы',
        'Расширенная статистика'
      ],
      uz: [
        '+50% ko\'proq XP',
        'Ustuvor qo\'llab-quvvatlash',
        'Reklamasiz',
        'Kengaytirilgan statistika'
      ]
    }
  },
  {
    id: 'pro',
    name: { ru: 'Pro', uz: 'Pro' },
    price: 19,
    originalPrice: 39,
    color: 'purple',
    popular: true,
    features: {
      ru: [
        'Все возможности Basic',
        'Все AI-инструменты',
        'Безлимитные запросы',
        'Экспорт результатов',
        'Персональный наставник'
      ],
      uz: [
        'Barcha Basic imkoniyatlar',
        'Barcha AI asboblar',
        'Cheksiz so\'rovlar',
        'Natijalarni eksport qilish',
        'Shaxsiy murabbiy'
      ]
    }
  },
  {
    id: 'master',
    name: { ru: 'Master', uz: 'Usta' },
    price: 29,
    originalPrice: 59,
    color: 'gold',
    features: {
      ru: [
        'Все возможности Pro',
        'MVP-генератор',
        'Эксклюзивные инструменты',
        'Белая метка',
        'API доступ',
        'Титул "Хранитель ИИ"'
      ],
      uz: [
        'Barcha Pro imkoniyatlar',
        'MVP generator',
        'Eksklyuziv asboblar',
        'Oq yorliq',
        'API kirish',
        '"AI Qo\'riqchisi" unvoni'
      ]
    }
  }
];

export const getLevelByXP = (xp: number): number => {
  for (let i = XP_THRESHOLDS.length - 1; i >= 0; i--) {
    if (xp >= XP_THRESHOLDS[i]) {
      return i;
    }
  }
  return 0;
};

export const getXPForNextLevel = (level: number): number => {
  return XP_THRESHOLDS[level + 1] || MAX_XP;
};

export const getXPProgress = (xp: number, level: number): number => {
  const currentLevelXP = XP_THRESHOLDS[level];
  const nextLevelXP = getXPForNextLevel(level);
  return ((xp - currentLevelXP) / (nextLevelXP - currentLevelXP)) * 100;
};

export const getUserTitle = (level: number, lang: 'ru' | 'uz'): string => {
  if (level <= 2) return lang === 'ru' ? 'Новичок' : 'Yangi boshlovchi';
  if (level <= 4) return lang === 'ru' ? 'Искатель' : 'Izlovchi';
  if (level <= 6) return lang === 'ru' ? 'Искусный' : 'Mohir';
  if (level <= 8) return lang === 'ru' ? 'Архитектор' : 'Arxitektor';
  return lang === 'ru' ? 'Хранитель ИИ' : 'AI Qo\'riqchisi';
};

// ==========================================
// COMPONENTS/ERRORHANDLER.TSX
// ==========================================

import React, { Component, ErrorInfo, ReactNode } from 'react';
import { logError } from '../lib/utils/errorLogger';
import { getUserLanguage } from '../lib/utils/i18n';

interface Props {
  children: ReactNode;
  fallback?: ReactNode;
}

interface State {
  hasError: boolean;
  error: Error | null;
  errorInfo: ErrorInfo | null;
}

class ErrorBoundary extends Component<Props, State> {
  constructor(props: Props) {
    super(props);
    this.state = {
      hasError: false,
      error: null,
      errorInfo: null
    };
  }

  static getDerivedStateFromError(error: Error): State {
    // Update state so the next render will show the fallback UI
    return {
      hasError: true,
      error,
      errorInfo: null
    };
  }

  componentDidCatch(error: Error, errorInfo: ErrorInfo): void {
    // Log the error to our error tracking system
    console.error('React Error Boundary caught an error:', error, errorInfo);
    
    this.setState({
      error,
      errorInfo
    });
    
    // Log to centralized error system
    logError(error, {
      component: 'ErrorBoundary',
      action: 'componentDidCatch',
      additionalData: {
        componentStack: errorInfo.componentStack
      }
    });
    
    // Try to recover by resetting some state
    try {
      // Clear any potentially corrupted state
      localStorage.setItem('neuropul_error_occurred', 'true');
      localStorage.setItem('neuropul_error_timestamp', new Date().toISOString());
      localStorage.setItem('neuropul_error_message', error.message);
    } catch (storageError) {
      console.error('Failed to save error info to localStorage:', storageError);
    }
  }

  render(): ReactNode {
    if (this.state.hasError) {
      // Get user language
      const language = getUserLanguage();
      
      // Custom fallback UI
      return this.props.fallback || (
        <div className="min-h-screen bg-gradient-to-br from-red-900 via-purple-900 to-blue-900 flex items-center justify-center p-4">
          <div className="bg-black bg-opacity-50 rounded-xl p-8 max-w-md text-center">
            <div className="text-6xl mb-4">⚠️</div>
            <h2 className="text-2xl font-bold text-white mb-4">
              {language === 'ru' ? 'Что-то пошло не так' : 'Nimadir noto\'g\'ri bajarildi'}
            </h2>
            <p className="text-gray-300 mb-6">
              {language === 'ru' 
                ? 'Произошла ошибка в приложении. Пожалуйста, обновите страницу.' 
                : 'Ilovada xatolik yuz berdi. Iltimos, sahifani yangilang.'}
            </p>
            <p className="text-red-400 text-sm mb-6 bg-red-900 bg-opacity-30 p-3 rounded-lg">
              {this.state.error?.message || (language === 'ru' ? 'Неизвестная ошибка' : 'Noma\'lum xato')}
            </p>
            <button
              onClick={() => window.location.reload()}
              className="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg transition-colors"
            >
              {language === 'ru' ? 'Обновить страницу' : 'Sahifani yangilash'}
            </button>
          </div>
        </div>
      );
    }

    return this.props.children;
  }
}

export default ErrorBoundary;

// ==========================================
// COMPONENTS/FOCUSMANAGER.TSX
// ==========================================

import React, { useEffect, useRef } from 'react';
import { logError } from '../lib/utils/errorLogger';

interface FocusManagerProps {
  children: React.ReactNode;
}

/**
 * Component to manage focus for accessibility
 * Ensures focus is properly managed during navigation
 */
const FocusManager: React.FC<FocusManagerProps> = ({ children }) => {
  const lastFocusedElement = useRef<HTMLElement | null>(null);
  const containerRef = useRef<HTMLDivElement>(null);

  // Save the last focused element before navigation
  useEffect(() => {
    try {
      const saveFocus = () => {
        lastFocusedElement.current = document.activeElement as HTMLElement;
      };

      // Listen for navigation events
      window.addEventListener('beforeunload', saveFocus);
      
      // Cleanup
      return () => {
        window.removeEventListener('beforeunload', saveFocus);
      };
    } catch (error) {
      console.error('Error in focus management:', error);
      logError(error, {
        component: 'FocusManager',
        action: 'saveFocus'
      });
    }
  }, []);

  // Restore focus after navigation
  useEffect(() => {
    try {
      // If we have a container and a previously focused element
      if (containerRef.current && lastFocusedElement.current) {
        // Check if the element is still in the document
        if (document.body.contains(lastFocusedElement.current)) {
          lastFocusedElement.current.focus();
        } else {
          // Focus the first focusable element in the container
          const focusableElements = containerRef.current.querySelectorAll(
            'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
          );
          
          if (focusableElements.length > 0) {
            (focusableElements[0] as HTMLElement).focus();
          }
        }
      }
    } catch (error) {
      console.error('Error restoring focus:', error);
      logError(error, {
        component: 'FocusManager',
        action: 'restoreFocus'
      });
    }
  }, []);

  return (
    <div ref={containerRef}>
      {children}
    </div>
  );
};

export default FocusManager;

// ==========================================
// PAGES/NOTFOUNDPAGE.TSX
// ==========================================

import React from 'react';
import { motion } from 'framer-motion';
import { Home, AlertTriangle } from 'lucide-react';
import { getUserLanguage } from '../lib/utils/i18n';

interface NotFoundPageProps {
  onGoHome: () => void;
}

const NotFoundPage: React.FC<NotFoundPageProps> = ({ onGoHome }) => {
  const language = getUserLanguage();
  
  return (
    <div className="min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-blue-900 flex items-center justify-center p-4">
      <motion.div
        initial={{ opacity: 0, scale: 0.9 }}
        animate={{ opacity: 1, scale: 1 }}
        transition={{ duration: 0.5 }}
        className="bg-black bg-opacity-40 backdrop-blur-md rounded-2xl p-8 border border-purple-500 border-opacity-30 shadow-2xl max-w-md w-full text-center"
      >
        <motion.div
          initial={{ scale: 0 }}
          animate={{ scale: 1 }}
          transition={{ delay: 0.2, type: "spring", stiffness: 200 }}
          className="w-24 h-24 mx-auto mb-6 bg-gradient-to-r from-red-500 to-orange-500 rounded-full flex items-center justify-center"
        >
          <AlertTriangle className="w-12 h-12 text-white" />
        </motion.div>
        
        <h1 className="text-4xl font-bold text-white mb-4">404</h1>
        <h2 className="text-2xl font-bold text-white mb-6">
          {language === 'ru' ? 'Страница не найдена' : 'Sahifa topilmadi'}
        </h2>
        
        <p className="text-gray-300 mb-8">
          {language === 'ru' 
            ? 'Запрошенная страница не существует или была перемещена.' 
            : 'So\'ralgan sahifa mavjud emas yoki ko\'chirilgan.'}
        </p>
        
        <motion.button
          whileHover={{ scale: 1.05 }}
          whileTap={{ scale: 0.95 }}
          onClick={onGoHome}
          className="bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white px-6 py-3 rounded-lg transition-colors flex items-center justify-center space-x-2 mx-auto"
        >
          <Home className="w-5 h-5" />
          <span>
            {language === 'ru' ? 'Вернуться на главную' : 'Bosh sahifaga qaytish'}
          </span>
        </motion.button>
        
        {/* Cyberpunk decorative elements */}
        <div className="absolute -bottom-3 -right-3 w-24 h-24 border-r-2 border-b-2 border-red-500 opacity-50 animate-pulse"></div>
        <div className="absolute -top-3 -left-3 w-24 h-24 border-l-2 border-t-2 border-purple-500 opacity-50 animate-pulse" style={{ animationDelay: '1.5s' }}></div>
      </motion.div>
    </div>
  );
};

export default NotFoundPage;

// ==========================================
// COMPONENTS/RESPONSELOSTOUL.TSX
// ==========================================

import React, { useState, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Brain, ArrowRight, HelpCircle, Zap, Lightbulb } from 'lucide-react';
import { logError } from '../lib/utils/errorLogger';

interface ResponseLostSoulProps {
  onContinue: () => void;
  onBack: () => void;
}

const ResponseLostSoul: React.FC<ResponseLostSoulProps> = ({ onContinue, onBack }) => {
  const [isVisible, setIsVisible] = useState(false);
  const [message, setMessage] = useState('');
  const [isTyping, setIsTyping] = useState(true);
  const [showContinue, setShowContinue] = useState(false);
  const [userName, setUserName] = useState('');
  const [language, setLanguage] = useState<'ru' | 'uz'>('ru');
  const [isNavigating, setIsNavigating] = useState(false);

  // Load language preference
  useEffect(() => {
    try {
      const urlParams = new URLSearchParams(window.location.search);
      const langParam = urlParams.get('lang');
      
      if (langParam === 'uz' || langParam === 'ru') {
        setLanguage(langParam);
        console.log(`Language set from URL: ${langParam}`);
      } else {
        const savedLang = localStorage.getItem('neuropul_language');
        if (savedLang === 'uz' || savedLang === 'ru') {
          setLanguage(savedLang);
          console.log(`Language set from localStorage: ${savedLang}`);
        } else {
          // Default to Russian
          setLanguage('ru');
          console.log('Language defaulted to Russian');
        }
      }
    } catch (error) {
      console.error('Error loading language preference:', error);
      logError(error, {
        component: 'ResponseLostSoul',
        action: 'loadLanguage'
      });
      // Default to Russian on error
      setLanguage('ru');
    }
  }, []);

  // Trae's response to lost souls
  const getTraeMessage = () => {
    return language === 'ru' 
      ? "Не парься, бро. Все мы когда-то были потеряны. AI — это просто инструмент, как молоток или отвёртка, только для мозга.\n\nПредставь, что у тебя есть умный помощник, который может писать тексты, создавать картинки, анализировать данные и отвечать на вопросы. Это и есть AI.\n\nНе нужно быть программистом или гением. Просто скажи, что тебе нужно — и AI сделает это за тебя. Это как иметь суперсилу."
      : "Xavotir olma, birodar. Hammamiz ham qachondir yo'qolgan edik. AI - bu shunchaki asbob, xuddi bolg'a yoki otvertka kabi, faqat miyangiz uchun.\n\nTasavvur qiling, sizda matnlarni yozadigan, rasmlar yaratadigan, ma'lumotlarni tahlil qiladigan va savollarga javob beradigan aqlli yordamchi bor. Bu AI.\n\nDasturchi yoki daho bo'lish shart emas. Shunchaki sizga nima kerakligini ayting - va AI buni siz uchun qiladi. Bu xuddi superkuchga ega bo'lish kabi.";
  };

  // Simulate typing effect
  useEffect(() => {
    try {
      setIsVisible(true);
      
      // Try to get user name from localStorage
      const savedName = localStorage.getItem('neuropul_user_name');
      if (savedName) {
        setUserName(savedName);
        console.log(`User name loaded: ${savedName}`);
      }
      
      const traeMessage = getTraeMessage();
      let currentText = '';
      let currentIndex = 0;
      
      const typingInterval = setInterval(() => {
        if (currentIndex < traeMessage.length) {
          currentText += traeMessage[currentIndex];
          setMessage(currentText);
          currentIndex++;
        } else {
          clearInterval(typingInterval);
          setIsTyping(false);
          
          // Show continue button after message is fully typed
          setTimeout(() => {
            setShowContinue(true);
          }, 500);
        }
      }, 20); // Typing speed
      
      return () => clearInterval(typingInterval);
    } catch (error) {
      console.error('Error in typing effect:', error);
      logError(error, {
        component: 'ResponseLostSoul',
        action: 'typingEffect'
      });
      
      // Fallback to show message immediately
      setMessage(getTraeMessage());
      setIsTyping(false);
      setShowContinue(true);
    }
  }, [language]);

  // Sound effects with more cyberpunk feel
  const playSound = (type: 'click' | 'hover') => {
    try {
      const audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      if (type === 'click') {
        // More digital, cyberpunk click sound
        oscillator.type = 'sawtooth';
        oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
        oscillator.frequency.setValueAtTime(330, audioContext.currentTime + 0.1);
        gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.2);
      } else {
        // More digital, cyberpunk hover sound
        oscillator.type = 'square';
        oscillator.frequency.setValueAtTime(660, audioContext.currentTime);
        gainNode.gain.setValueAtTime(0.05, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.1);
      }
    } catch (error) {
      console.error('Audio not supported:', error);
    }
  };

  // Vibration feedback
  const vibrate = (pattern: number[]) => {
    try {
      if (navigator.vibrate) {
        navigator.vibrate(pattern);
      }
    } catch (error) {
      console.error('Vibration not supported:', error);
    }
  };

  const handleContinue = () => {
    try {
      if (isNavigating) {
        console.log('Navigation already in progress, ignoring');
        return;
      }
      
      console.log('Continue button clicked');
      setIsNavigating(true);
      
      playSound('click');
      vibrate([50, 30, 50]);
      
      // Save user experience level
      localStorage.setItem('neuropul_user_experience', 'beginner');
      localStorage.setItem('neuropul_user_path', 'lost');
      
      // Track progress
      const visitCount = parseInt(localStorage.getItem('neuropul_visit_count') || '0');
      localStorage.setItem('neuropul_visit_count', (visitCount + 1).toString());
      
      // Set flag for potential CTA later
      localStorage.setItem('neuropul_viewed_messages', '1');
      
      // Call onContinue with a small delay
      setTimeout(() => {
        onContinue();
      }, 100);
    } catch (error) {
      console.error('Error in handleContinue:', error);
      logError(error, {
        component: 'ResponseLostSoul',
        action: 'handleContinue'
      });
      
      // Reset navigation state
      setIsNavigating(false);
    }
  };

  const handleBack = () => {
    try {
      if (isNavigating) {
        console.log('Navigation already in progress, ignoring');
        return;
      }
      
      console.log('Back button clicked');
      setIsNavigating(true);
      
      playSound('click');
      vibrate([30]);
      
      // Call onBack with a small delay
      setTimeout(() => {
        onBack();
      }, 100);
    } catch (error) {
      console.error('Error in handleBack:', error);
      logError(error, {
        component: 'ResponseLostSoul',
        action: 'handleBack'
      });
      
      // Reset navigation state
      setIsNavigating(false);
    }
  };

  // Handle name input
  const [showNameInput, setShowNameInput] = useState(false);
  const [nameInput, setNameInput] = useState('');

  const handleNameSubmit = () => {
    try {
      if (nameInput.trim()) {
        localStorage.setItem('neuropul_user_name', nameInput.trim());
        setUserName(nameInput.trim());
        setShowNameInput(false);
        playSound('click');
        vibrate([50, 30, 50]);
      }
    } catch (error) {
      console.error('Error in handleNameSubmit:', error);
      logError(error, {
        component: 'ResponseLostSoul',
        action: 'handleNameSubmit'
      });
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-blue-900 flex items-center justify-center p-4 overflow-hidden">
      {/* Background cyberpunk elements with enhanced effects */}
      <div className="absolute inset-0 overflow-hidden">
        {/* Cyberpunk grid */}
        <div className="absolute top-0 left-0 w-full h-full bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxkZWZzPjxwYXR0ZXJuIGlkPSJncmlkIiB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHBhdHRlcm5Vbml0cz0idXNlclNwYWNlT25Vc2UiPjxwYXRoIGQ9Ik0gNDAgMCBMIDAgMCAwIDQwIiBmaWxsPSJub25lIiBzdHJva2U9IiM4YjVjZjYiIHN0cm9rZS13aWR0aD0iMC41Ii8+PC9wYXR0ZXJuPjwvZGVmcz48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ1cmwoI2dyaWQpIiBvcGFjaXR5PSIwLjA1Ii8+PC9zdmc+')]"></div>
        
        {/* Animated glowing orbs */}
        <div className="absolute top-1/4 left-1/4 w-96 h-96 bg-purple-500 rounded-full filter blur-[100px] opacity-20 animate-pulse"></div>
        <div className="absolute bottom-1/4 right-1/4 w-96 h-96 bg-blue-500 rounded-full filter blur-[100px] opacity-20 animate-pulse" style={{ animationDelay: '1s' }}></div>
        
        {/* Digital rain effect (matrix-like) */}
        <div className="absolute inset-0 opacity-10 pointer-events-none overflow-hidden">
          <div className="absolute top-0 left-0 w-full h-full">
            {Array.from({ length: 10 }).map((_, i) => (
              <div 
                key={i}
                className="absolute text-cyan-500 text-xs font-mono"
                style={{
                  left: `${Math.random() * 100}%`,
                  top: 0,
                  opacity: 0.5 + Math.random() * 0.5,
                  animation: `digitalRain ${5 + Math.random() * 10}s linear infinite`,
                  animationDelay: `${Math.random() * 5}s`
                }}
              >
                {Array.from({ length: 20 }).map((_, j) => (
                  <div key={j} className="my-1">
                    {Math.random() > 0.5 ? '1' : '0'}
                  </div>
                ))}
              </div>
            ))}
          </div>
        </div>
        
        {/* Scanlines effect */}
        <div className="absolute inset-0 bg-scanline opacity-5 pointer-events-none"></div>
      </div>
      
      {/* Language switcher */}
      <div className="absolute top-4 right-4 z-20">
        <button 
          onClick={() => {
            const newLang = language === 'ru' ? 'uz' : 'ru';
            setLanguage(newLang);
            localStorage.setItem('neuropul_language', newLang);
            // Update URL with language parameter
            const url = new URL(window.location.href);
            url.searchParams.set('lang', newLang);
            window.history.replaceState({}, '', url.toString());
          }}
          className="bg-black bg-opacity-50 text-white px-4 py-2 rounded-lg text-sm hover:bg-opacity-70 transition-colors"
          aria-label={language === 'ru' ? 'Переключить на узбекский' : 'Rus tiliga o\'tish'}
          disabled={isNavigating}
        >
          {language === 'ru' ? 'O\'zbekcha' : 'Русский'}
        </button>
      </div>
      
      <div className="relative z-10 max-w-3xl w-full">
        <AnimatePresence>
          {isVisible && (
            <motion.div
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              exit={{ opacity: 0, y: -20 }}
              transition={{ duration: 0.5 }}
              className="bg-black bg-opacity-40 backdrop-blur-md rounded-2xl p-8 border border-purple-500 border-opacity-30 shadow-2xl"
            >
              {/* Trae Header with enhanced cyberpunk style */}
              <div className="flex items-center mb-6">
                <div className="w-14 h-14 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full flex items-center justify-center mr-4 shadow-[0_0_15px_rgba(139,92,246,0.5)] relative">
                  {/* Pulsing ring effect */}
                  <div className="absolute inset-0 rounded-full border border-purple-500 animate-ping opacity-30"></div>
                  <Brain className="w-8 h-8 text-white" />
                </div>
                <div>
                  <h2 className="text-2xl font-bold text-white font-['Orbitron',sans-serif]">Trae</h2>
                  <p className="text-purple-300 text-sm">
                    {language === 'ru' ? 'AI-Наставник' : 'AI-Murabbiy'}
                  </p>
                </div>
                
                {/* Connection status indicator */}
                <div className="ml-auto flex items-center">
                  <div className="w-2 h-2 rounded-full bg-green-500 mr-2 animate-pulse"></div>
                  <span className="text-green-400 text-xs">ONLINE</span>
                </div>
              </div>
              
              {/* Message with glitch effect */}
              <div className="mb-8 relative">
                <p className="text-white text-lg leading-relaxed whitespace-pre-line font-['Courier_New',monospace] relative">
                  {userName ? `${language === 'ru' ? 'Привет, ' : 'Salom, '}${userName}! ` : ''}
                  {message}
                  {isTyping && (
                    <span className="inline-block ml-1 animate-pulse">|</span>
                  )}
                </p>
                
                {/* Glitch effect overlay */}
                <div className="absolute inset-0 pointer-events-none overflow-hidden opacity-10">
                  <div className="glitch-text">{message}</div>
                </div>
              </div>
              
              {/* Name input */}
              {showContinue && !userName && !showNameInput && (
                <motion.div
                  initial={{ opacity: 0, y: 10 }}
                  animate={{ opacity: 1, y: 0 }}
                  className="mb-6"
                >
                  <button
                    onClick={() => setShowNameInput(true)}
                    className="text-cyan-400 hover:text-cyan-300 transition-colors text-sm"
                    aria-label={language === 'ru' ? 'Кстати, как тебя зовут?' : 'Aytgancha, ismingiz nima?'}
                    disabled={isNavigating}
                  >
                    {language === 'ru' ? 'Кстати, как тебя зовут?' : 'Aytgancha, ismingiz nima?'}
                  </button>
                </motion.div>
              )}
              
              {showNameInput && (
                <motion.div
                  initial={{ opacity: 0, y: 10 }}
                  animate={{ opacity: 1, y: 0 }}
                  className="mb-6 flex space-x-2"
                >
                  <input
                    type="text"
                    value={nameInput}
                    onChange={(e) => setNameInput(e.target.value)}
                    placeholder={language === 'ru' ? 'Введи своё имя...' : 'Ismingizni kiriting...'}
                    className="flex-1 bg-gray-800 border border-gray-700 focus:border-cyan-500 rounded-lg px-4 py-2 text-white placeholder-gray-500 focus:outline-none"
                    onKeyPress={(e) => e.key === 'Enter' && handleNameSubmit()}
                    autoFocus
                    aria-label={language === 'ru' ? 'Ваше имя' : 'Ismingiz'}
                    disabled={isNavigating}
                  />
                  <button
                    onClick={handleNameSubmit}
                    className="px-4 py-2 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg transition-colors"
                    aria-label={language === 'ru' ? 'Сохранить' : 'Saqlash'}
                    disabled={isNavigating}
                  >
                    {language === 'ru' ? 'Сохранить' : 'Saqlash'}
                  </button>
                </motion.div>
              )}
              
              {/* AI Benefits with enhanced visual style */}
              <AnimatePresence>
                {showContinue && (
                  <motion.div
                    initial={{ opacity: 0, y: 20 }}
                    animate={{ opacity: 1, y: 0 }}
                    transition={{ duration: 0.5 }}
                    className="mb-8"
                  >
                    <h3 className="text-cyan-400 font-semibold mb-4 flex items-center font-['Orbitron',sans-serif]">
                      <Lightbulb className="w-5 h-5 mr-2" />
                      {language === 'ru' 
                        ? 'Что AI может сделать для тебя:' 
                        : 'AI siz uchun nima qila oladi:'}
                    </h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <motion.div 
                        initial={{ opacity: 0, x: -20 }}
                        animate={{ opacity: 1, x: 0 }}
                        transition={{ delay: 0.1 }}
                        className="bg-gray-800 bg-opacity-50 p-4 rounded-lg border border-gray-700 hover:border-cyan-500 transition-colors group"
                      >
                        <div className="flex items-center space-x-3 mb-2">
                          <Zap className="w-5 h-5 text-yellow-400 group-hover:text-yellow-300 transition-colors" />
                          <span className="text-white font-semibold">
                            {language === 'ru' ? 'Сэкономить время' : 'Vaqtni tejash'}
                          </span>
                        </div>
                        <p className="text-gray-300 text-sm">
                          {language === 'ru' 
                            ? 'Автоматизируй рутинные задачи и сосредоточься на важном' 
                            : 'Kundalik vazifalarni avtomatlashtiring va muhim narsalarga e\'tibor bering'}
                        </p>
                      </motion.div>
                      <motion.div 
                        initial={{ opacity: 0, x: -20 }}
                        animate={{ opacity: 1, x: 0 }}
                        transition={{ delay: 0.2 }}
                        className="bg-gray-800 bg-opacity-50 p-4 rounded-lg border border-gray-700 hover:border-cyan-500 transition-colors group"
                      >
                        <div className="flex items-center space-x-3 mb-2">
                          <Zap className="w-5 h-5 text-yellow-400 group-hover:text-yellow-300 transition-colors" />
                          <span className="text-white font-semibold">
                            {language === 'ru' ? 'Генерировать идеи' : 'G\'oyalar yaratish'}
                          </span>
                        </div>
                        <p className="text-gray-300 text-sm">
                          {language === 'ru' 
                            ? 'Получай свежие идеи для бизнеса, контента или творчества' 
                            : 'Biznes, kontent yoki ijod uchun yangi g\'oyalar oling'}
                        </p>
                      </motion.div>
                      <motion.div 
                        initial={{ opacity: 0, x: -20 }}
                        animate={{ opacity: 1, x: 0 }}
                        transition={{ delay: 0.3 }}
                        className="bg-gray-800 bg-opacity-50 p-4 rounded-lg border border-gray-700 hover:border-cyan-500 transition-colors group"
                      >
                        <div className="flex items-center space-x-3 mb-2">
                          <Zap className="w-5 h-5 text-yellow-400 group-hover:text-yellow-300 transition-colors" />
                          <span className="text-white font-semibold">
                            {language === 'ru' ? 'Создавать контент' : 'Kontent yaratish'}
                          </span>
                        </div>
                        <p className="text-gray-300 text-sm">
                          {language === 'ru' 
                            ? 'Тексты, изображения, код — всё за считанные секунды' 
                            : 'Matnlar, rasmlar, kod - hammasi soniyalar ichida'}
                        </p>
                      </motion.div>
                      <motion.div 
                        initial={{ opacity: 0, x: -20 }}
                        animate={{ opacity: 1, x: 0 }}
                        transition={{ delay: 0.4 }}
                        className="bg-gray-800 bg-opacity-50 p-4 rounded-lg border border-gray-700 hover:border-cyan-500 transition-colors group"
                      >
                        <div className="flex items-center space-x-3 mb-2">
                          <Zap className="w-5 h-5 text-yellow-400 group-hover:text-yellow-300 transition-colors" />
                          <span className="text-white font-semibold">
                            {language === 'ru' ? 'Учиться быстрее' : 'Tezroq o\'rganish'}
                          </span>
                        </div>
                        <p className="text-gray-300 text-sm">
                          {language === 'ru' 
                            ? 'Получай объяснения сложных тем простым языком' 
                            : 'Murakkab mavzularni oddiy tilda tushuntirishlar oling'}
                        </p>
                      </motion.div>
                    </div>
                  </motion.div>
                )}
              </AnimatePresence>
              
              {/* Progress indicator */}
              {showContinue && (
                <motion.div
                  initial={{ opacity: 0 }}
                  animate={{ opacity: 1 }}
                  transition={{ delay: 0.5 }}
                  className="mb-6"
                >
                  <div className="w-full bg-gray-800 h-1 rounded-full overflow-hidden">
                    <div className="bg-gradient-to-r from-purple-500 to-cyan-500 h-full w-1/3 rounded-full"></div>
                  </div>
                  <div className="flex justify-between text-xs text-gray-500 mt-1">
                    <span>{language === 'ru' ? 'Начало' : 'Boshlanish'}</span>
                    <span>{language === 'ru' ? 'Пробуждение' : 'Uyg\'onish'}</span>
                    <span>{language === 'ru' ? 'Мастерство' : 'Mahorat'}</span>
                  </div>
                </motion.div>
              )}
              
              {/* Buttons with enhanced cyberpunk style */}
              <AnimatePresence>
                {showContinue && (
                  <motion.div
                    initial={{ opacity: 0, y: 20 }}
                    animate={{ opacity: 1, y: 0 }}
                    transition={{ duration: 0.5, delay: 0.2 }}
                    className="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4"
                  >
                    <button
                      onClick={handleBack}
                      onMouseEnter={() => playSound('hover')}
                      className="px-6 py-3 bg-gray-800 hover:bg-gray-700 text-gray-300 hover:text-white rounded-lg transition-colors flex items-center justify-center space-x-2 border border-gray-700 hover:border-purple-500 group relative overflow-hidden"
                      aria-label={language === 'ru' ? 'Назад' : 'Orqaga'}
                      disabled={isNavigating}
                    >
                      {/* Button hover effect */}
                      <div className="absolute inset-0 bg-gradient-to-r from-purple-600 to-blue-600 opacity-0 group-hover:opacity-10 transition-opacity"></div>
                      
                      <ArrowRight className="w-5 h-5 rotate-180" />
                      <span>{language === 'ru' ? 'Назад' : 'Orqaga'}</span>
                    </button>
                    
                    <button
                      onClick={handleContinue}
                      onMouseEnter={() => playSound('hover')}
                      className="flex-1 px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white rounded-lg transition-colors flex items-center justify-center space-x-2 relative overflow-hidden group"
                      aria-label={language === 'ru' ? 'Хочу пробудиться' : 'Uyg\'onishni xohlayman'}
                      disabled={isNavigating}
                    >
                      {/* Button glow effect */}
                      <div className="absolute -inset-1 bg-gradient-to-r from-purple-600 to-blue-600 rounded-lg blur opacity-30 group-hover:opacity-50 transition-opacity"></div>
                      <div className="relative z-10 flex items-center justify-center space-x-2">
                        <span>
                          {language === 'ru' ? 'Хочу пробудиться' : 'Uyg\'onishni xohlayman'}
                        </span>
                        <ArrowRight className="w-5 h-5" />
                      </div>
                    </button>
                    
                    <button
                      onClick={() => {
                        window.open('https://chat.openai.com', '_blank', 'noopener,noreferrer');
                      }}
                      onMouseEnter={() => playSound('hover')}
                      className="px-6 py-3 bg-gray-800 hover:bg-gray-700 text-gray-300 hover:text-white rounded-lg transition-colors flex items-center justify-center space-x-2 border border-gray-700 hover:border-purple-500 group relative overflow-hidden"
                      aria-label={language === 'ru' ? 'Узнать больше про AI' : 'AI haqida ko\'proq bilish'}
                      rel="noopener noreferrer"
                      disabled={isNavigating}
                    >
                      {/* Button hover effect */}
                      <div className="absolute inset-0 bg-gradient-to-r from-purple-600 to-blue-600 opacity-0 group-hover:opacity-10 transition-opacity"></div>
                      
                      <HelpCircle className="w-5 h-5" />
                      <span>
                        {language === 'ru' ? 'Узнать больше про AI' : 'AI haqida ko\'proq bilish'}
                      </span>
                    </button>
                  </motion.div>
                )}
              </AnimatePresence>
              
              {/* Loading indicator */}
              {isNavigating && (
                <motion.div
                  initial={{ opacity: 0 }}
                  animate={{ opacity: 1 }}
                  className="mt-6 flex justify-center"
                >
                  <div className="flex items-center space-x-3">
                    <div className="w-4 h-4 bg-purple-600 rounded-full animate-pulse"></div>
                    <div className="w-4 h-4 bg-blue-600 rounded-full animate-pulse" style={{ animationDelay: '0.3s' }}></div>
                    <div className="w-4 h-4 bg-cyan-600 rounded-full animate-pulse" style={{ animationDelay: '0.6s' }}></div>
                  </div>
                </motion.div>
              )}
              
              {/* Cyberpunk decorative elements with enhanced effects */}
              <div className="absolute -bottom-3 -right-3 w-24 h-24 border-r-2 border-b-2 border-cyan-500 opacity-50 animate-pulse"></div>
              <div className="absolute -top-3 -left-3 w-24 h-24 border-l-2 border-t-2 border-purple-500 opacity-50 animate-pulse" style={{ animationDelay: '1.5s' }}></div>
              
              {/* Glitch corner effect */}
              <div className="absolute bottom-0 right-0 w-20 h-20 overflow-hidden opacity-30 pointer-events-none">
                <div className="absolute inset-0 glitch-corner"></div>
              </div>
              
              {/* Neuropul logo/branding */}
              <div className="absolute bottom-4 left-4 text-xs text-purple-500 opacity-50 font-['Orbitron',sans-serif]">
                NEUROPUL.AI
              </div>
            </motion.div>
          )}
        </AnimatePresence>
      </div>
      
      {/* Global CSS for cyberpunk effects */}
      <style jsx global>{`
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;900&display=swap');
        
        @keyframes digitalRain {
          0% { transform: translateY(-100px); }
          100% { transform: translateY(100vh); }
        }
        
        .bg-scanline {
          background: linear-gradient(
            to bottom,
            transparent 50%,
            rgba(0, 0, 0, 0.5) 50%
          );
          background-size: 100% 4px;
        }
        
        .glitch-text {
          position: relative;
          animation: glitch 3s infinite;
          color: rgba(139, 92, 246, 0.5);
        }
        
        @keyframes glitch {
          0% { transform: translate(0); }
          20% { transform: translate(-2px, 2px); }
          40% { transform: translate(-2px, -2px); }
          60% { transform: translate(2px, 2px); }
          80% { transform: translate(2px, -2px); }
          100% { transform: translate(0); }
        }
        
        .glitch-corner {
          background: linear-gradient(45deg, transparent 48%, #00ffff 49%, transparent 51%);
          animation: cornerGlitch 2s infinite;
        }
        
        @keyframes cornerGlitch {
          0% { transform: scale(1); opacity: 0.3; }
          50% { transform: scale(1.2); opacity: 0.6; }
          51% { transform: scale(0.8); opacity: 0.3; }
          100% { transform: scale(1); opacity: 0.3; }
        }
      `}</style>
    </div>
  );
};

export default ResponseLostSoul;

// ==========================================
// COMPONENTS/RESPONSEHACKERREADY.TSX
// ==========================================

import React, { useState, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { Brain, ArrowRight, Code, Zap, Terminal, Lock } from 'lucide-react';
import { logError } from '../lib/utils/errorLogger';

interface ResponseHackerReadyProps {
  onContinue: () => void;
  onBack: () => void;
}

const ResponseHackerReady: React.FC<ResponseHackerReadyProps> = ({ onContinue, onBack }) => {
  const [isVisible, setIsVisible] = useState(false);
  const [message, setMessage] = useState('');
  const [isTyping, setIsTyping] = useState(true);
  const [showContinue, setShowContinue] = useState(false);
  const [userName, setUserName] = useState('');
  const [xp, setXp] = useState(0);
  const [isPaid, setIsPaid] = useState(false);
  const [language, setLanguage] = useState<'ru' | 'uz'>('ru');
  const [isNavigating, setIsNavigating] = useState(false);

  // Load language preference
  useEffect(() => {
    try {
      const urlParams = new URLSearchParams(window.location.search);
      const langParam = urlParams.get('lang');
      
      if (langParam === 'uz' || langParam === 'ru') {
        setLanguage(langParam);
        console.log(`Language set from URL: ${langParam}`);
      } else {
        const savedLang = localStorage.getItem('neuropul_language');
        if (savedLang === 'uz' || savedLang === 'ru') {
          setLanguage(savedLang);
          console.log(`Language set from localStorage: ${savedLang}`);
        } else {
          // Default to Russian
          setLanguage('ru');
          console.log('Language defaulted to Russian');
        }
      }
    } catch (error) {
      console.error('Error loading language preference:', error);
      logError(error, {
        component: 'ResponseHackerReady',
        action: 'loadLanguage'
      });
      // Default to Russian on error
      setLanguage('ru');
    }
  }, []);

  // Trae's response to those who are already familiar with AI
  const getTraeMessage = () => {
    return language === 'ru' 
      ? "Вот это я понимаю. Хакер в доме.\n\nРаз ты уже в теме, давай без лишних слов. У меня есть набор продвинутых AI-инструментов, которые выведут твои навыки на новый уровень.\n\nМы определим твой архетип, чтобы персонализировать опыт. Затем ты получишь доступ к генераторам идей, кода, контента и многому другому.\n\nПлюс, тут есть система XP и уровней. Каждое использование AI приносит опыт и разблокирует новые возможности."
      : "Mana buni tushunaman. Xaker uyda.\n\nAgar siz allaqachon mavzuda bo'lsangiz, ortiqcha so'zlarsiz. Menda sizning ko'nikmalaringizni yangi darajaga ko'taradigan ilg'or AI vositalari to'plami bor.\n\nTajribani shaxsiylashtirish uchun arxetipingizni aniqlaymiz. Keyin siz g'oya, kod, kontent generatorlari va boshqa ko'p narsalarga kirish huquqini olasiz.\n\nBundan tashqari, bu yerda XP va darajalar tizimi mavjud. AI-dan har bir foydalanish tajriba keltiradi va yangi imkoniyatlarni ochadi.";
  };

  // Simulate typing effect
  useEffect(() => {
    try {
      setIsVisible(true);
      
      // Try to get user name from localStorage
      const savedName = localStorage.getItem('neuropul_user_name');
      if (savedName) {
        setUserName(savedName);
        console.log(`User name loaded: ${savedName}`);
      }
      
      // Check if user has paid status
      const userPaid = localStorage.getItem('neuropul_is_paid') === 'true';
      setIsPaid(userPaid);
      
      const traeMessage = getTraeMessage();
      let currentText = '';
      let currentIndex = 0;
      
      const typingInterval = setInterval(() => {
        if (currentIndex < traeMessage.length) {
          currentText += traeMessage[currentIndex];
          setMessage(currentText);
          currentIndex++;
        } else {
          clearInterval(typingInterval);
          setIsTyping(false);
          
          // Show continue button after message is fully typed
          setTimeout(() => {
            setShowContinue(true);
            
            // Award XP for reaching this step
            const currentXp = parseInt(localStorage.getItem('neuropul_xp') || '0');
            const newXp = currentXp + 15; // More XP for advanced users
            localStorage.setItem('neuropul_xp', newXp.toString());
            setXp(newXp);
            
            // Play XP sound
            playSound('xp');
            vibrate([50, 30, 50]);
          }, 500);
        }
      }, 20); // Typing speed
      
      return () => clearInterval(typingInterval);
    } catch (error) {
      console.error('Error in typing effect:', error);
      logError(error, {
        component: 'ResponseHackerReady',
        action: 'typingEffect'
      });
      
      // Fallback to show message immediately
      setMessage(getTraeMessage());
      setIsTyping(false);
      setShowContinue(true);
    }
  }, [language]);

  // Sound effects with more cyberpunk feel
  const playSound = (type: 'click' | 'hover' | 'xp') => {
    try {
      const audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      if (type === 'click') {
        // More digital, cyberpunk click sound
        oscillator.type = 'sawtooth';
        oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
        oscillator.frequency.setValueAtTime(330, audioContext.currentTime + 0.1);
        gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.2);
      } else if (type === 'xp') {
        // XP gain sound
        oscillator.type = 'sine';
        oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
        oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); // E5
        oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2); // G5
        gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.3);
      } else {
        // More digital, cyberpunk hover sound
        oscillator.type = 'square';
        oscillator.frequency.setValueAtTime(660, audioContext.currentTime);
        gainNode.gain.setValueAtTime(0.05, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.1);
      }
    } catch (error) {
      console.error('Audio not supported:', error);
    }
  };

  // Vibration feedback
  const vibrate = (pattern: number[]) => {
    try {
      if (navigator.vibrate) {
        navigator.vibrate(pattern);
      }
    } catch (error) {
      console.error('Vibration not supported:', error);
    }
  };

  const handleContinue = () => {
    try {
      if (isNavigating) {
        console.log('Navigation already in progress, ignoring');
        return;
      }
      
      console.log('Continue button clicked');
      setIsNavigating(true);
      
      playSound('click');
      vibrate([50, 30, 50]);
      
      // Save user experience level
      localStorage.setItem('neuropul_user_experience', 'advanced');
      localStorage.setItem('neuropul_user_path', 'ready');
      
      // Track progress
      const visitCount = parseInt(localStorage.getItem('neuropul_visit_count') || '0');
      localStorage.setItem('neuropul_visit_count', (visitCount + 1).toString());
      
      // Set flag for potential CTA later
      localStorage.setItem('neuropul_viewed_messages', '3');
      
      // Set flag for advanced tools
      localStorage.setItem('neuropul_advanced_tools_unlocked', 'true');
      
      // Call onContinue with a small delay
      setTimeout(() => {
        onContinue();
      }, 100);
    } catch (error) {
      console.error('Error in handleContinue:', error);
      logError(error, {
        component: 'ResponseHackerReady',
        action: 'handleContinue'
      });
      
      // Reset navigation state
      setIsNavigating(false);
    }
  };

  const handleBack = () => {
    try {
      if (isNavigating) {
        console.log('Navigation already in progress, ignoring');
        return;
      }
      
      console.log('Back button clicked');
      setIsNavigating(true);
      
      playSound('click');
      vibrate([30]);
      
      // Call onBack with a small delay
      setTimeout(() => {
        onBack();
      }, 100);
    } catch (error) {
      console.error('Error in handleBack:', error);
      logError(error, {
        component: 'ResponseHackerReady',
        action: 'handleBack'
      });
      
      // Reset navigation state
      setIsNavigating(false);
    }
  };

  // Handle name input
  const [showNameInput, setShowNameInput] = useState(false);
  const [nameInput, setNameInput] = useState('');

  const handleNameSubmit = () => {
    try {
      if (nameInput.trim()) {
        localStorage.setItem('neuropul_user_name', nameInput.trim());
        setUserName(nameInput.trim());
        setShowNameInput(false);
        playSound('click');
        vibrate([50, 30, 50]);
        
        // Award XP for setting name
        const currentXp = parseInt(localStorage.getItem('neuropul_xp') || '0');
        const newXp = currentXp + 5;
        localStorage.setItem('neuropul_xp', newXp.toString());
        setXp(newXp);
      }
    } catch (error) {
      console.error('Error in handleNameSubmit:', error);
      logError(error, {
        component: 'ResponseHackerReady',
        action: 'handleNameSubmit'
      });
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-blue-900 flex items-center justify-center p-4 overflow-hidden">
      {/* Background cyberpunk elements with enhanced effects */}
      <div className="absolute inset-0 overflow-hidden">
        {/* Cyberpunk grid */}
        <div className="absolute top-0 left-0 w-full h-full bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxkZWZzPjxwYXR0ZXJuIGlkPSJncmlkIiB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHBhdHRlcm5Vbml0cz0idXNlclNwYWNlT25Vc2UiPjxwYXRoIGQ9Ik0gNDAgMCBMIDAgMCAwIDQwIiBmaWxsPSJub25lIiBzdHJva2U9IiM4YjVjZjYiIHN0cm9rZS13aWR0aD0iMC41Ii8+PC9wYXR0ZXJuPjwvZGVmcz48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ1cmwoI2dyaWQpIiBvcGFjaXR5PSIwLjA1Ii8+PC9zdmc+')]"></div>
        
        {/* Animated glowing orbs */}
        <div className="absolute top-1/4 left-1/4 w-96 h-96 bg-purple-500 rounded-full filter blur-[100px] opacity-20 animate-pulse"></div>
        <div className="absolute bottom-1/4 right-1/4 w-96 h-96 bg-blue-500 rounded-full filter blur-[100px] opacity-20 animate-pulse" style={{ animationDelay: '1s' }}></div>
        
        {/* Digital rain effect (matrix-like) */}
        <div className="absolute inset-0 opacity-10 pointer-events-none overflow-hidden">
          <div className="absolute top-0 left-0 w-full h-full">
            {Array.from({ length: 10 }).map((_, i) => (
              <div 
                key={i}
                className="absolute text-cyan-500 text-xs font-mono"
                style={{
                  left: `${Math.random() * 100}%`,
                  top: 0,
                  opacity: 0.5 + Math.random() * 0.5,
                  animation: `digitalRain ${5 + Math.random() * 10}s linear infinite`,
                  animationDelay: `${Math.random() * 5}s`
                }}
              >
                {Array.from({ length: 20 }).map((_, j) => (
                  <div key={j} className="my-1">
                    {Math.random() > 0.5 ? '1' : '0'}
                  </div>
                ))}
              </div>
            ))}
          </div>
        </div>
        
        {/* Scanlines effect */}
        <div className="absolute inset-0 bg-scanline opacity-5 pointer-events-none"></div>
        
        {/* Hacker video background (if available) */}
        <div className="absolute inset-0 opacity-20 pointer-events-none overflow-hidden">
          <div className="absolute inset-0 bg-gradient-to-br from-purple-900/50 to-blue-900/50"></div>
          <div className="absolute inset-0 bg-[url('https://media.giphy.com/media/3oKIPtjEDVUQv1GE4U/giphy.gif')] bg-cover bg-center opacity-30 mix-blend-screen"></div>
        </div>
      </div>
      
      {/* Language switcher */}
      <div className="absolute top-4 right-4 z-20">
        <button 
          onClick={() => {
            const newLang = language === 'ru' ? 'uz' : 'ru';
            setLanguage(newLang);
            localStorage.setItem('neuropul_language', newLang);
            // Update URL with language parameter
            const url = new URL(window.location.href);
            url.searchParams.set('lang', newLang);
            window.history.replaceState({}, '', url.toString());
          }}
          className="bg-black bg-opacity-50 text-white px-4 py-2 rounded-lg text-sm hover:bg-opacity-70 transition-colors"
          aria-label={language === 'ru' ? 'Переключить на узбекский' : 'Rus tiliga o\'tish'}
          disabled={isNavigating}
        >
          {language === 'ru' ? 'O\'zbekcha' : 'Русский'}
        </button>
      </div>
      
      <div className="relative z-10 max-w-3xl w-full">
        <AnimatePresence>
          {isVisible && (
            <motion.div
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              exit={{ opacity: 0, y: -20 }}
              transition={{ duration: 0.5 }}
              className="bg-black bg-opacity-40 backdrop-blur-md rounded-2xl p-8 border border-purple-500 border-opacity-30 shadow-2xl"
            >
              {/* Trae Header with enhanced cyberpunk style */}
              <div className="flex items-center mb-6">
                <div className="w-14 h-14 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full flex items-center justify-center mr-4 shadow-[0_0_15px_rgba(139,92,246,0.5)] relative">
                  {/* Pulsing ring effect */}
                  <div className="absolute inset-0 rounded-full border border-purple-500 animate-ping opacity-30"></div>
                  <Brain className="w-8 h-8 text-white" />
                </div>
                <div>
                  <h2 className="text-2xl font-bold text-white font-['Orbitron',sans-serif]">Trae</h2>
                  <p className="text-purple-300 text-sm">
                    {language === 'ru' ? 'AI-Наставник' : 'AI-Murabbiy'}
                  </p>
                </div>
                
                {/* XP indicator */}
                {xp > 0 && (
                  <div className="ml-auto flex items-center bg-purple-900/50 px-3 py-1 rounded-full border border-purple-500/30">
                    <Zap className="w-4 h-4 text-yellow-400 mr-1" />
                    <span className="text-yellow-400 text-xs font-bold">{xp} XP</span>
                  </div>
                )}
              </div>
              
              {/* Message with glitch effect */}
              <div className="mb-8 relative">
                <p className="text-white text-lg leading-relaxed whitespace-pre-line font-['Courier_New',monospace] relative">
                  {userName ? `${userName}, ` : ''}
                  {message}
                  {isTyping && (
                    <span className="inline-block ml-1 animate-pulse">|</span>
                  )}
                </p>
                
                {/* Glitch effect overlay */}
                <div className="absolute inset-0 pointer-events-none overflow-hidden opacity-10">
                  <div className="glitch-text">{message}</div>
                </div>
              </div>
              
              {/* Name input */}
              {showContinue && !userName && !showNameInput && (
                <motion.div
                  initial={{ opacity: 0, y: 10 }}
                  animate={{ opacity: 1, y: 0 }}
                  className="mb-6"
                >
                  <button
                    onClick={() => setShowNameInput(true)}
                    className="text-cyan-400 hover:text-cyan-300 transition-colors text-sm"
                    aria-label={language === 'ru' ? 'Как мне к тебе обращаться, хакер?' : 'Sizga qanday murojaat qilishim kerak, xaker?'}
                    disabled={isNavigating}
                  >
                    {language === 'ru' 
                      ? 'Как мне к тебе обращаться, хакер?' 
                      : 'Sizga qanday murojaat qilishim kerak, xaker?'}
                  </button>
                </motion.div>
              )}
              
              {showNameInput && (
                <motion.div
                  initial={{ opacity: 0, y: 10 }}
                  animate={{ opacity: 1, y: 0 }}
                  className="mb-6 flex space-x-2"
                >
                  <input
                    type="text"
                    value={nameInput}
                    onChange={(e) => setNameInput(e.target.value)}
                    placeholder={language === 'ru' 
                      ? 'Введи своё имя или хендл...' 
                      : 'Ismingizni yoki taxallusingizni kiriting...'}
                    className="flex-1 bg-gray-800 border border-gray-700 focus:border-cyan-500 rounded-lg px-4 py-2 text-white placeholder-gray-500 focus:outline-none"
                    onKeyPress={(e) => e.key === 'Enter' && handleNameSubmit()}
                    autoFocus
                    aria-label={language === 'ru' ? 'Ваше имя или хендл' : 'Ismingiz yoki taxallusingiz'}
                    disabled={isNavigating}
                  />
                  <button
                    onClick={handleNameSubmit}
                    className="px-4 py-2 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg transition-colors"
                    aria-label={language === 'ru' ? 'Сохранить' : 'Saqlash'}
                    disabled={isNavigating}
                  >
                    {language === 'ru' ? 'Сохранить' : 'Saqlash'}
                  </button>
                </motion.div>
              )}
              
              {/* Advanced Tools with enhanced visual style */}
              <AnimatePresence>
                {showContinue && (
                  <motion.div
                    initial={{ opacity: 0, y: 20 }}
                    animate={{ opacity: 1, y: 0 }}
                    transition={{ duration: 0.5 }}
                    className="mb-8"
                  >
                    <h3 className="text-cyan-400 font-semibold mb-4 flex items-center font-['Orbitron',sans-serif]">
                      <Terminal className="w-5 h-5 mr-2" />
                      {language === 'ru' ? 'Доступные инструменты:' : 'Mavjud vositalar:'}
                    </h3>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <motion.div 
                        initial={{ opacity: 0, x: -20 }}
                        animate={{ opacity: 1, x: 0 }}
                        transition={{ delay: 0.1 }}
                        className="bg-gray-800 bg-opacity-50 p-4 rounded-lg border border-gray-700 hover:border-cyan-500 transition-colors group relative overflow-hidden"
                      >
                        {/* Tool hover effect */}
                        <div className="absolute inset-0 bg-gradient-to-r from-green-600/20 to-green-800/20 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                        
                        <div className="flex items-center space-x-3 mb-2 relative z-10">
                          <Code className="w-5 h-5 text-green-400 group-hover:text-green-300 transition-colors" />
                          <span className="text-white font-semibold">
                            {language === 'ru' ? 'Генератор кода' : 'Kod generatori'}
                          </span>
                        </div>
                        <p className="text-gray-300 text-sm relative z-10">
                          {language === 'ru' 
                            ? 'Создавай код на любом языке программирования' 
                            : 'Istalgan dasturlash tilida kod yarating'}
                        </p>
                      </motion.div>
                      
                      <motion.div 
                        initial={{ opacity: 0, x: -20 }}
                        animate={{ opacity: 1, x: 0 }}
                        transition={{ delay: 0.2 }}
                        className="bg-gray-800 bg-opacity-50 p-4 rounded-lg border border-gray-700 hover:border-cyan-500 transition-colors group relative overflow-hidden"
                      >
                        {/* Premium tool indicator */}
                        {!isPaid && (
                          <div className="absolute top-2 right-2 z-20">
                            <div className="bg-yellow-500 bg-opacity-20 p-1 rounded-full">
                              <Lock className="w-3 h-3 text-yellow-400" />
                            </div>
                          </div>
                        )}
                        
                        {/* Tool hover effect */}
                        <div className="absolute inset-0 bg-gradient-to-r from-yellow-600/20 to-yellow-800/20 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                        
                        <div className="flex items-center space-x-3 mb-2 relative z-10">
                          <Zap className="w-5 h-5 text-yellow-400 group-hover:text-yellow-300 transition-colors" />
                          <span className="text-white font-semibold">
                            {language === 'ru' ? 'MVP-генератор' : 'MVP-generator'}
                          </span>
                          {!isPaid && <span className="text-xs text-yellow-400">PRO</span>}
                        </div>
                        <p className="text-gray-300 text-sm relative z-10">
                          {language === 'ru' 
                            ? 'Быстрое создание минимально жизнеспособного продукта' 
                            : 'Minimal hayotiy mahsulotni tez yaratish'}
                        </p>
                      </motion.div>
                      
                      <motion.div 
                        initial={{ opacity: 0, x: -20 }}
                        animate={{ opacity: 1, x: 0 }}
                        transition={{ delay: 0.3 }}
                        className="bg-gray-800 bg-opacity-50 p-4 rounded-lg border border-gray-700 hover:border-cyan-500 transition-colors group relative overflow-hidden"
                      >
                        {/* Tool hover effect */}
                        <div className="absolute inset-0 bg-gradient-to-r from-purple-600/20 to-purple-800/20 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                        
                        <div className="flex items-center space-x-3 mb-2 relative z-10">
                          <Terminal className="w-5 h-5 text-purple-400 group-hover:text-purple-300 transition-colors" />
                          <span className="text-white font-semibold">
                            {language === 'ru' ? 'Промпт-инженер' : 'Prompt-muhandis'}
                          </span>
                        </div>
                        <p className="text-gray-300 text-sm relative z-10">
                          {language === 'ru' 
                            ? 'Создание и оптимизация промптов для лучших результатов' 
                            : 'Eng yaxshi natijalar uchun promptlarni yaratish va optimallashtirish'}
                        </p>
                      </motion.div>
                      
                      <motion.div 
                        initial={{ opacity: 0, x: -20 }}
                        animate={{ opacity: 1, x: 0 }}
                        transition={{ delay: 0.4 }}
                        className="bg-gray-800 bg-opacity-50 p-4 rounded-lg border border-gray-700 hover:border-cyan-500 transition-colors group relative overflow-hidden"
                      >
                        {/* Tool hover effect */}
                        <div className="absolute inset-0 bg-gradient-to-r from-blue-600/20 to-blue-800/20 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                        
                        <div className="flex items-center space-x-3 mb-2 relative z-10">
                          <Brain className="w-5 h-5 text-blue-400 group-hover:text-blue-300 transition-colors" />
                          <span className="text-white font-semibold">
                            {language === 'ru' ? 'AI-ассистент' : 'AI-yordamchi'}
                          </span>
                        </div>
                        <p className="text-gray-300 text-sm relative z-10">
                          {language === 'ru' 
                            ? 'Персональный помощник для решения любых задач' 
                            : 'Har qanday vazifani hal qilish uchun shaxsiy yordamchi'}
                        </p>
                      </motion.div>
                    </div>
                  </motion.div>
                )}
              </AnimatePresence>
              
              {/* Progress indicator */}
              {showContinue && (
                <motion.div
                  initial={{ opacity: 0 }}
                  animate={{ opacity: 1 }}
                  transition={{ delay: 0.5 }}
                  className="mb-6"
                >
                  <div className="w-full bg-gray-800 h-1 rounded-full overflow-hidden">
                    <div className="bg-gradient-to-r from-purple-500 to-cyan-500 h-full w-1/3 rounded-full"></div>
                  </div>
                  <div className="flex justify-between text-xs text-gray-500 mt-1">
                    <span>{language === 'ru' ? 'Начало' : 'Boshlanish'}</span>
                    <span>{language === 'ru' ? 'Пробуждение' : 'Uyg\'onish'}</span>
                    <span>{language === 'ru' ? 'Мастерство' : 'Mahorat'}</span>
                  </div>
                </motion.div>
              )}
              
              {/* Buttons with enhanced cyberpunk style */}
              <AnimatePresence>
                {showContinue && (
                  <motion.div
                    initial={{ opacity: 0, y: 20 }}
                    animate={{ opacity: 1, y: 0 }}
                    transition={{ duration: 0.5, delay: 0.2 }}
                    className="flex space-x-4"
                  >
                    <button
                      onClick={handleBack}
                      onMouseEnter={() => playSound('hover')}
                      className="px-6 py-3 bg-gray-800 hover:bg-gray-700 text-gray-300 hover:text-white rounded-lg transition-colors flex items-center justify-center space-x-2 border border-gray-700 hover:border-purple-500 group relative overflow-hidden"
                      aria-label={language === 'ru' ? 'Назад' : 'Orqaga'}
                      disabled={isNavigating}
                    >
                      {/* Button hover effect */}
                      <div className="absolute inset-0 bg-gradient-to-r from-purple-600 to-blue-600 opacity-0 group-hover:opacity-10 transition-opacity"></div>
                      
                      <ArrowRight className="w-5 h-5 rotate-180" />
                      <span>{language === 'ru' ? 'Назад' : 'Orqaga'}</span>
                    </button>
                    
                    <button
                      onClick={handleContinue}
                      onMouseEnter={() => playSound('hover')}
                      className="flex-1 px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white rounded-lg transition-colors flex items-center justify-center space-x-2 relative overflow-hidden group"
                      aria-label={language === 'ru' ? 'Перейти к инструментам' : 'Vositalarga o\'tish'}
                      disabled={isNavigating}
                    >
                      {/* Button glow effect */}
                      <div className="absolute -inset-1 bg-gradient-to-r from-purple-600 to-blue-600 rounded-lg blur opacity-30 group-hover:opacity-50 transition-opacity"></div>
                      <div className="relative z-10 flex items-center justify-center space-x-2">
                        <Terminal className="w-5 h-5" />
                        <span>
                          {language === 'ru' ? 'Перейти к инструментам' : 'Vositalarga o\'tish'}
                        </span>
                        <ArrowRight className="w-5 h-5" />
                      </div>
                    </button>
                  </motion.div>
                )}
              </AnimatePresence>
              
              {/* Loading indicator */}
              {isNavigating && (
                <motion.div
                  initial={{ opacity: 0 }}
                  animate={{ opacity: 1 }}
                  className="mt-6 flex justify-center"
                >
                  <div className="flex items-center space-x-3">
                    <div className="w-4 h-4 bg-purple-600 rounded-full animate-pulse"></div>
                    <div className="w-4 h-4 bg-blue-600 rounded-full animate-pulse" style={{ animationDelay: '0.3s' }}></div>
                    <div className="w-4 h-4 bg-cyan-600 rounded-full animate-pulse" style={{ animationDelay: '0.6s' }}></div>
                  </div>
                </motion.div>
              )}
              
              {/* CTA for premium */}
              {showContinue && !isPaid && (
                <motion.div
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ delay: 0.7 }}
                  className="mt-6 bg-gradient-to-r from-yellow-900/30 to-orange-900/30 rounded-lg p-4 border border-yellow-500/30"
                >
                  <div className="flex items-start space-x-3">
                    <div className="bg-yellow-500/20 p-2 rounded-full">
                      <Lock className="w-5 h-5 text-yellow-400" />
                    </div>
                    <div>
                      <h4 className="text-yellow-400 font-semibold mb-1">
                        {language === 'ru' ? 'Разблокируй полную мощь AI' : 'AI-ning to\'liq kuchini ochib bering'}
                      </h4>
                      <p className="text-yellow-200 text-sm mb-2">
                        {language === 'ru' 
                          ? 'Получи доступ ко всем продвинутым инструментам и функциям' 
                          : 'Barcha ilg\'or vositalar va funksiyalarga kirish huquqini oling'}
                      </p>
                      <button
                        onClick={() => {
                          // Set flag for CTA view
                          localStorage.setItem('neuropul_cta_viewed', 'true');
                          // Continue to next step
                          handleContinue();
                        }}
                        className="text-sm bg-gradient-to-r from-yellow-600 to-orange-600 hover:from-yellow-500 hover:to-orange-500 text-white px-4 py-2 rounded-lg transition-colors inline-flex items-center space-x-2"
                        aria-label={language === 'ru' ? 'Узнать больше' : 'Ko\'proq bilish'}
                        disabled={isNavigating}
                      >
                        <Zap className="w-4 h-4" />
                        <span>
                          {language === 'ru' ? 'Узнать больше' : 'Ko\'proq bilish'}
                        </span>
                      </button>
                    </div>
                  </div>
                </motion.div>
              )}
              
              {/* Cyberpunk decorative elements with enhanced effects */}
              <div className="absolute -bottom-3 -right-3 w-24 h-24 border-r-2 border-b-2 border-cyan-500 opacity-50 animate-pulse"></div>
              <div className="absolute -top-3 -left-3 w-24 h-24 border-l-2 border-t-2 border-purple-500 opacity-50 animate-pulse" style={{ animationDelay: '1.5s' }}></div>
              
              {/* Glitch corner effect */}
              <div className="absolute bottom-0 right-0 w-20 h-20 overflow-hidden opacity-30 pointer-events-none">
                <div className="absolute inset-0 glitch-corner"></div>
              </div>
              
              {/* Neuropul logo/branding */}
              <div className="absolute bottom-4 left-4 text-xs text-purple-500 opacity-50 font-['Orbitron',sans-serif]">
                NEUROPUL.AI
              </div>
            </motion.div>
          )}
        </AnimatePresence>
      </div>
      
      {/* Global CSS for cyberpunk effects */}
      <style jsx global>{`
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;900&display=swap');
        
        @keyframes digitalRain {
          0% { transform: translateY(-100px); }
          100% { transform: translateY(100vh); }
        }
        
        .bg-scanline {
          background: linear-gradient(
            to bottom,
            transparent 50%,
            rgba(0, 0, 0, 0.5) 50%
          );
          background-size: 100% 4px;
        }
        
        .glitch-text {
          position: relative;
          animation: glitch 3s infinite;
          color: rgba(139, 92, 246, 0.5);
        }
        
        @keyframes glitch {
          0% { transform: translate(0); }
          20% { transform: translate(-2px, 2px); }
          40% { transform: translate(-2px, -2px); }
          60% { transform: translate(2px, 2px); }
          80% { transform: translate(2px, -2px); }
          100% { transform: translate(0); }
        }
        
        .glitch-corner {
          background: linear-gradient(45deg, transparent 48%, #00ffff 49%, transparent 51%);
          animation: cornerGlitch 2s infinite;
        }
        
        @keyframes cornerGlitch {
          0% { transform: scale(1); opacity: 0.3; }
          50% { transform: scale(1.2); opacity: 0.6; }
          51% { transform: scale(0.8); opacity: 0.3; }
          100% { transform: scale(1); opacity: 0.3; }
        }
      `}</style>
    </div>
  );
};

export default ResponseHackerReady;

// ==========================================
// STYLES/CYBERPUNK.CSS
// ==========================================

@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;900&display=swap');

/* Cyberpunk animations */
@keyframes digitalRain {
  0% { transform: translateY(-100px); }
  100% { transform: translateY(100vh); }
}

@keyframes glitch {
  0% { transform: translate(0); }
  20% { transform: translate(-2px, 2px); }
  40% { transform: translate(-2px, -2px); }
  60% { transform: translate(2px, 2px); }
  80% { transform: translate(2px, -2px); }
  100% { transform: translate(0); }
}

@keyframes cornerGlitch {
  0% { transform: scale(1); opacity: 0.3; }
  50% { transform: scale(1.2); opacity: 0.6; }
  51% { transform: scale(0.8); opacity: 0.3; }
  100% { transform: scale(1); opacity: 0.3; }
}

@keyframes neonPulse {
  0% { box-shadow: 0 0 5px rgba(139, 92, 246, 0.5), 0 0 10px rgba(139, 92, 246, 0.3); }
  50% { box-shadow: 0 0 10px rgba(139, 92, 246, 0.8), 0 0 20px rgba(139, 92, 246, 0.5); }
  100% { box-shadow: 0 0 5px rgba(139, 92, 246, 0.5), 0 0 10px rgba(139, 92, 246, 0.3); }
}

@keyframes textFlicker {
  0% { opacity: 1; }
  10% { opacity: 0.8; }
  11% { opacity: 1; }
  50% { opacity: 1; }
  51% { opacity: 0.9; }
  60% { opacity: 1; }
  92% { opacity: 1; }
  93% { opacity: 0.8; }
  94% { opacity: 1; }
}

/* Cyberpunk elements */
.bg-scanline {
  background: linear-gradient(
    to bottom,
    transparent 50%,
    rgba(0, 0, 0, 0.5) 50%
  );
  background-size: 100% 4px;
}

.glitch-text {
  position: relative;
  animation: glitch 3s infinite;
  color: rgba(139, 92, 246, 0.5);
}

.glitch-corner {
  background: linear-gradient(45deg, transparent 48%, #00ffff 49%, transparent 51%);
  animation: cornerGlitch 2s infinite;
}

.neon-border {
  border: 1px solid rgba(139, 92, 246, 0.5);
  box-shadow: 0 0 10px rgba(139, 92, 246, 0.5), inset 0 0 5px rgba(139, 92, 246, 0.2);
  animation: neonPulse 2s infinite;
}

.text-flicker {
  animation: textFlicker 3s infinite;
}

.cyberpunk-font {
  font-family: 'Orbitron', sans-serif;
}

.terminal-font {
  font-family: 'Courier New', monospace;
}

/* Cyberpunk grid background */
.cyberpunk-grid {
  background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxkZWZzPjxwYXR0ZXJuIGlkPSJncmlkIiB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHBhdHRlcm5Vbml0cz0idXNlclNwYWNlT25Vc2UiPjxwYXRoIGQ9Ik0gNDAgMCBMIDAgMCAwIDQwIiBmaWxsPSJub25lIiBzdHJva2U9IiM4YjVjZjYiIHN0cm9rZS13aWR0aD0iMC41Ii8+PC9wYXR0ZXJuPjwvZGVmcz48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSJ1cmwoI2dyaWQpIiBvcGFjaXR5PSIwLjA1Ii8+PC9zdmc+');
}

/* Cyberpunk button styles */
.cyberpunk-button {
  position: relative;
  overflow: hidden;
  transition: all 0.3s;
}

.cyberpunk-button::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    90deg,
    transparent,
    rgba(255, 255, 255, 0.2),
    transparent
  );
  transition: all 0.6s;
}

.cyberpunk-button:hover::before {
  left: 100%;
}

.cyberpunk-button:active {
  transform: scale(0.95);
}

/* Cyberpunk input styles */
.cyberpunk-input {
  background: rgba(30, 30, 30, 0.7);
  border: 1px solid rgba(139, 92, 246, 0.3);
  color: white;
  padding: 0.5rem 1rem;
  transition: all 0.3s;
}

.cyberpunk-input:focus {
  border-color: rgba(139, 92, 246, 0.8);
  box-shadow: 0 0 10px rgba(139, 92, 246, 0.5);
  outline: none;
}

/* Cyberpunk card styles */
.cyberpunk-card {
  background: rgba(0, 0, 0, 0.7);
  border: 1px solid rgba(139, 92, 246, 0.3);
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(10px);
  position: relative;
  overflow: hidden;
}

.cyberpunk-card::before {
  content: '';
  position: absolute;
  top: -2px;
  left: -2px;
  right: -2px;
  bottom: -2px;
  background: linear-gradient(45deg, #8b5cf6, #3b82f6, #06b6d4);
  z-index: -1;
  opacity: 0.3;
  border-radius: inherit;
}

/* Digital rain effect */
.digital-rain {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  overflow: hidden;
  opacity: 0.1;
}

.digital-rain-character {
  position: absolute;
  color: #06b6d4;
  font-family: monospace;
  font-size: 12px;
  animation: digitalRain linear infinite;
}

// ==========================================
// INDEX.CSS
// ==========================================

@tailwind base;
@tailwind components;
@tailwind utilities;

// ==========================================
// VITE.CONFIG.TS
// ==========================================

import { defineConfig, loadEnv } from 'vite';
import react from '@vitejs/plugin-react';

// https://vitejs.dev/config/
export default defineConfig(({ mode }) => {
  // Load env file based on mode
  const env = loadEnv(mode, process.cwd(), '');
  
  return {
    plugins: [react()],
    optimizeDeps: {
      exclude: ['lucide-react'],
    },
    server: {
      proxy: {
        '/api': {
          target: 'http://localhost:3000',
          changeOrigin: true,
        },
      },
    },
    define: {
      // Make env variables available to the client
      'import.meta.env.APP_ENV': JSON.stringify(env.APP_ENV || 'dev'),
      'import.meta.env.ENABLE_DEBUG': JSON.stringify(env.ENABLE_DEBUG === 'true'),
      'import.meta.env.DISABLE_PDF_GEN': JSON.stringify(env.DISABLE_PDF_GEN === 'true'),
      'import.meta.env.DEFAULT_LANGUAGE': JSON.stringify(env.DEFAULT_LANGUAGE || 'ru'),
    },
    build: {
      sourcemap: mode !== 'production',
      minify: 'terser',
      terserOptions: {
        compress: {
          drop_console: mode === 'production',
          drop_debugger: mode === 'production',
        },
      },
      rollupOptions: {
        output: {
          manualChunks: {
            react: ['react', 'react-dom'],
            framer: ['framer-motion'],
            supabase: ['@supabase/supabase-js'],
            router: ['react-router-dom'],
          },
        },
      },
    },
  };
});

// ==========================================
// NETLIFY.TOML
// ==========================================

[build]
  command = "npm run build"
  publish = "dist"
  functions = "api"

[dev]
  command = "npm run dev"
  port = 3000
  targetPort = 5173
  framework = "#custom"

[[redirects]]
  from = "/api/*"
  to = "/.netlify/functions/:splat"
  status = 200

[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

[functions]
  node_bundler = "esbuild"
  external_node_modules = ["html2canvas", "jspdf", "qrcode"]

[build.environment]
  NODE_VERSION = "20"
  NPM_VERSION = "10"
  VITE_SUPABASE_URL = "https://blmvkduhlkbovgrabthx.supabase.co"
  VITE_SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJsbXZrZHVobGtib3ZncmFidGh4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA1MTE3NjUsImV4cCI6MjA2NjA4Nzc2NX0.6AYOciFxfGqEerXPhWfGfQ6sTyWzHKnggX-r0iKbHoM"
  SUPABASE_SERVICE_ROLE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJsbXZrZHVobGtib3ZncmFidGh4Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1MDUxMTc2NSwiZXhwIjoyMDY2MDg3NzY1fQ.DLTMgIzG_36-SWFQpSLETjnH--Q9RnqsY5EPtd1BHMY"
  OPENAI_API_KEY = "sk-proj-HtKilSKj2bdLO5wcuIEMKST1tcq"
  APP_ENV = "production"
  ENABLE_DEBUG = "true"
  DISABLE_PDF_GEN = "false"
  DEFAULT_LANGUAGE = "ru"
  TIMEOUT = "30000"
  CHECK_STATUS = "true"
  ERROR_LOGGER = "true"

[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-XSS-Protection = "1; mode=block"
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "strict-origin-when-cross-origin"
    Content-Security-Policy = "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https://api.dicebear.com https://*.supabase.co https://*.pexels.com https://media.giphy.com; connect-src 'self' https://*.supabase.co https://api.openai.com;"
    Permissions-Policy = "camera=(), microphone=(), geolocation=(), interest-cohort=()"

// ==========================================
// TAILWIND.CONFIG.JS
// ==========================================

/** @type {import('tailwindcss').Config} */
export default {
  content: ['./index.html', './src/**/*.{js,ts,jsx,tsx}'],
  theme: {
    extend: {},
  },
  plugins: [],
};

// ==========================================
// POSTCSS.CONFIG.JS
// ==========================================

export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
};

// ==========================================
// TSCONFIG.JSON
// ==========================================

{
  "files": [],
  "references": [
    { "path": "./tsconfig.app.json" },
    { "path": "./tsconfig.node.json" }
  ]
}

// ==========================================
// TSCONFIG.APP.JSON
// ==========================================

{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true
  },
  "include": ["src"]
}

// ==========================================
// TSCONFIG.NODE.JSON
// ==========================================

{
  "compilerOptions": {
    "target": "ES2022",
    "lib": ["ES2023"],
    "module": "ESNext",
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true
  },
  "include": ["vite.config.ts"]
}

// ==========================================
// ESLINT.CONFIG.JS
// ==========================================

import js from '@eslint/js';
import globals from 'globals';
import reactHooks from 'eslint-plugin-react-hooks';
import reactRefresh from 'eslint-plugin-react-refresh';
import tseslint from 'typescript-eslint';

export default tseslint.config(
  { ignores: ['dist'] },
  {
    extends: [js.configs.recommended, ...tseslint.configs.recommended],
    files: ['**/*.{ts,tsx}'],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
    },
    plugins: {
      'react-hooks': reactHooks,
      'react-refresh': reactRefresh,
    },
    rules: {
      ...reactHooks.configs.recommended.rules,
      'react-refresh/only-export-components': [
        'warn',
        { allowConstantExport: true },
      ],
    },
  }
);

// ==========================================
// PUBLIC/MANIFEST.WEBMANIFEST
// ==========================================

{
  "name": "NeuropulAI - Твой путь к AI-мастерству",
  "short_name": "NeuropulAI",
  "description": "Геймифицированный AI-портал для изучения и использования искусственного интеллекта",
  "start_url": "/",
  "display": "standalone",
  "background_color": "#1a1a2e",
  "theme_color": "#1a1a2e",
  "icons": [
    {
      "src": "/icon-192.png",
      "sizes": "192x192",
      "type": "image/png"
    },
    {
      "src": "/icon-512.png",
      "sizes": "512x512",
      "type": "image/png"
    },
    {
      "src": "/maskable-icon.png",
      "sizes": "512x512",
      "type": "image/png",
      "purpose": "maskable"
    }
  ],
  "shortcuts": [
    {
      "name": "Пробуждение",
      "short_name": "Пробуждение",
      "description": "Начать путь пробуждения",
      "url": "/awakening",
      "icons": [{ "src": "/icon-192.png", "sizes": "192x192" }]
    },
    {
      "name": "Дашборд",
      "short_name": "Дашборд",
      "description": "Перейти к дашборду",
      "url": "/dashboard",
      "icons": [{ "src": "/icon-192.png", "sizes": "192x192" }]
    }
  ],
  "lang": "ru",
  "dir": "ltr",
  "categories": ["education", "productivity", "utilities"],
  "screenshots": [
    {
      "src": "/screenshot-1.jpg",
      "sizes": "1280x720",
      "type": "image/jpeg"
    },
    {
      "src": "/screenshot-2.jpg",
      "sizes": "1280x720",
      "type": "image/jpeg"
    }
  ]
}

// ==========================================
// PUBLIC/ROBOTS.TXT
// ==========================================

# https://www.robotstxt.org/robotstxt.html
User-agent: *
Allow: /

Sitemap: https://neuropul.ai/sitemap.xml

// ==========================================
// PUBLIC/SITEMAP.XML
// ==========================================

<?xml version="1.0" encoding="UTF-8"?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9"
        xmlns:xhtml="http://www.w3.org/1999/xhtml">
  <url>
    <loc>https://neuropul.ai/</loc>
    <xhtml:link rel="alternate" hreflang="ru" href="https://neuropul.ai/?lang=ru"/>
    <xhtml:link rel="alternate" hreflang="uz" href="https://neuropul.ai/?lang=uz"/>
    <lastmod>2025-06-30</lastmod>
    <changefreq>weekly</changefreq>
    <priority>1.0</priority>
  </url>
  <url>
    <loc>https://neuropul.ai/awakening</loc>
    <xhtml:link rel="alternate" hreflang="ru" href="https://neuropul.ai/awakening?lang=ru"/>
    <xhtml:link rel="alternate" hreflang="uz" href="https://neuropul.ai/awakening?lang=uz"/>
    <lastmod>2025-06-30</lastmod>
    <changefreq>monthly</changefreq>
    <priority>0.8</priority>
  </url>
  <url>
    <loc>https://neuropul.ai/dashboard</loc>
    <xhtml:link rel="alternate" hreflang="ru" href="https://neuropul.ai/dashboard?lang=ru"/>
    <xhtml:link rel="alternate" hreflang="uz" href="https://neuropul.ai/dashboard?lang=uz"/>
    <lastmod>2025-06-30</lastmod>
    <changefreq>weekly</changefreq>
    <priority>0.9</priority>
  </url>
</urlset>

// ==========================================
// PUBLIC/404.HTML
// ==========================================

<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>Страница не найдена - NeuropulAI</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      color: #fff;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    
    .container {
      max-width: 600px;
      padding: 2rem;
    }
    
    h1 {
      font-size: 3rem;
      margin-bottom: 1rem;
      background: linear-gradient(45deg, #667eea, #764ba2, #f093fb);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    p {
      font-size: 1.2rem;
      margin-bottom: 2rem;
      color: #a0a0ff;
      line-height: 1.6;
    }
    
    .button {
      display: inline-block;
      background: linear-gradient(45deg, #667eea, #764ba2);
      color: white;
      text-decoration: none;
      padding: 1rem 2rem;
      border-radius: 0.5rem;
      font-weight: bold;
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
    }
    
    .button:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
    }
    
    .button:active {
      transform: translateY(-1px);
    }
    
    .error-code {
      font-size: 8rem;
      font-weight: bold;
      opacity: 0.2;
      position: absolute;
      z-index: -1;
    }
    
    .brain-icon {
      font-size: 5rem;
      margin-bottom: 2rem;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.1);
      }
      100% {
        transform: scale(1);
      }
    }
  </style>
</head>
<body>
  <div class="error-code">404</div>
  <div class="container">
    <div class="brain-icon">🧠</div>
    <h1>Страница не найдена</h1>
    <p>Похоже, ты забрёл в неизведанную часть NeuropulAI. Эта страница не существует или была перемещена.</p>
    <a href="/" class="button">Вернуться на главную</a>
  </div>
  
  <script>
    // Redirect to SPA for client-side routing
    window.addEventListener('DOMContentLoaded', () => {
      // Only redirect if this is not a direct hit on 404.html
      if (window.location.pathname !== '/404.html') {
        window.location.href = '/?redirect=' + encodeURIComponent(window.location.pathname);
      }
    });
  </script>
</body>
</html>

// ==========================================
// END OF FILE
// ==========================================